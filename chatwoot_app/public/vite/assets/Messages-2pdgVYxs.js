import{m as T,S as B,k as $,e as M,j as re,t as W,g as N,C as ie,r as le}from"./useBranding-78t2cBKJ.js";import{g as O}from"./utils.esm-CMazHLgs.js";import{C as de}from"./Button-0URonJLr.js";import{F as w}from"./module-CxJOWM_e.js";import{_ as p,x as l,n as r,o,p as d,m as P,t as _,e as b,a as h,l as V,g as m,z as C,I as U,i as x,q as v,k as D,b as ce,F as E,j as A,af as Y,M as H,W as ue,f as q,ag as me}from"./_plugin-vue_export-helper-DG4P_01H.js";import{G as he,s as X,H as ge,R as pe,y as K,J as _e,_ as be}from"./typing-DAnjQ7Xa.js";import{B as F,a as fe}from"./Validators-BM89Tp7H.js";import{c as J,s as ye,I as z,A as Ce,u as ve}from"./widget-BcosoSvU.js";import Te from"./EmojiInput-DjQg_Tdj.js";import{j as ke,g as Se}from"./sharedFrameEvents-0qZ2yOho.js";import{u as j}from"./vue-dompurify-html-CEAHYyWB.js";import{e as Ee,r as Ae,u as we}from"./index-Cw6s38ZS.js";import{_ as Ie}from"./StarRating-BCKNPX3F.js";import{_ as xe,y as Re,D as Me}from"./index-BfMIn2Vn.js";import{M as Z}from"./constants-lVAyZKq6.js";import"./Icon-Br_HG2DA.js";import"./index-DN3rM4CW.js";import"./_commonjsHelpers-BosuxZz1.js";import"./Branding-BS-MvpW4.js";const Fe={name:"FooterReplyTo",components:{FluentIcon:w},props:{inReplyTo:{type:Object,default:()=>{}}},emits:["dismiss"],computed:{replyToAttachment(){var n,s;if(!((s=(n=this.inReplyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.inReplyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}}},Oe={class:"mb-2.5 rounded-[7px] bg-n-slate-3 px-2 py-1.5 text-sm text-n-slate-11 flex items-center gap-2"},Le={class:"items-center flex-grow truncate"};function Be(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",Oe,[d("div",Le,[d("strong",null,_(e.$t("FOOTER_REPLY_TO.REPLY_TO")),1),P(" "+_(s.inReplyTo.content||t.replyToAttachment),1)]),d("button",{class:"items-end flex-shrink-0 p-1 rounded-md hover:bg-n-slate-5",onClick:n[0]||(n[0]=c=>e.$emit("dismiss"))},[b(a,{icon:"dismiss",size:"12"})])])}const Ue=p(Fe,[["render",Be]]),Pe={components:{FluentIcon:w,FileUpload:he,Spinner:B},props:{onAttach:{type:Function,default:()=>{}}},data(){return{isUploading:!1}},computed:{...T({globalConfig:"globalConfig/get",shouldShowFilePicker:"appConfig/getShouldShowFilePicker"}),fileUploadSizeLimit(){return $},allowedFileTypes(){return re}},mounted(){document.addEventListener("paste",this.handleClipboardPaste)},unmounted(){document.removeEventListener("paste",this.handleClipboardPaste)},methods:{handleClipboardPaste(e){if(!this.shouldShowFilePicker)return;const n=(e.clipboardData||e.originalEvent.clipboardData).items;Array.from(n).forEach(u=>{if(u.kind==="file"){e.preventDefault();const i=u.getAsFile();this.$refs.upload.add(i)}})},getFileType(e){return e.includes("image")?"image":"file"},async onFileUpload(e){this.globalConfig.directUploadsEnabled?await this.onDirectFileUpload(e):await this.onIndirectFileUpload(e)},async onDirectFileUpload(e){if(e){this.isUploading=!0;try{if(X(e,$)){const{websiteToken:n}=window.chatwootWebChannel;new ge.DirectUpload(e.file,`/api/v1/widget/direct_uploads?website_token=${n}`,{directUploadWillCreateBlobWithXHR:u=>{u.setRequestHeader("X-Auth-Token",window.authToken)}}).create((u,i)=>{u?M.emit(F.SHOW_ALERT,{message:u}):this.onAttach({file:i.signed_id,...this.getLocalFileAttributes(e)})})}else M.emit(F.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},async onIndirectFileUpload(e){if(e){this.isUploading=!0;try{X(e,$)?await this.onAttach({file:e.file,...this.getLocalFileAttributes(e)}):M.emit(F.SHOW_ALERT,{message:this.$t("FILE_SIZE_LIMIT",{MAXIMUM_FILE_UPLOAD_SIZE:this.fileUploadSizeLimit})})}catch{}this.isUploading=!1}},getLocalFileAttributes(e){return{thumbUrl:window.URL.createObjectURL(e.file),fileType:this.getFileType(e.type)}}}},Ve={class:"min-h-8 min-w-8 flex items-center justify-center"};function De(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner"),g=l("FileUpload");return o(),h(g,{ref:"upload",size:4096*2048,accept:t.allowedFileTypes,data:{direct_upload_url:"/api/v1/widget/direct_uploads",direct_upload:!0},onInputFile:t.onFileUpload},{default:V(()=>[d("button",Ve,[i.isUploading.image?m("",!0):(o(),h(a,{key:0,icon:"attach"})),i.isUploading?(o(),h(c,{key:1,size:"small"})):m("",!0)])]),_:1},8,["accept","onInputFile"])}const je=p(Pe,[["render",De]]),$e={components:{FluentIcon:w,Spinner:B},props:{loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},color:{type:String,default:"#6e6f73"}}},Ne=["disabled"];function We(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner");return o(),r("button",{type:"submit",disabled:s.disabled,class:"min-h-8 min-w-8 flex items-center justify-center ml-1"},[s.loading?(o(),h(c,{key:1,size:"small"})):(o(),h(a,{key:0,icon:"send",style:C(`color: ${s.color}`)},null,8,["style"]))],8,Ne)}const ze=p($e,[["render",We]]),He={name:"ChatInputWrap",components:{ChatAttachmentButton:je,ChatSendButton:ze,EmojiInput:Te,FluentIcon:w,ResizableTextArea:pe},mixins:[J],props:{onSendMessage:{type:Function,default:()=>{}},onSendAttachment:{type:Function,default:()=>{}}},data(){return{userInput:"",showEmojiPicker:!1,isFocused:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor",isWidgetOpen:"appConfig/getIsWidgetOpen",shouldShowFilePicker:"appConfig/getShouldShowFilePicker",shouldShowEmojiPicker:"appConfig/getShouldShowEmojiPicker"}),showAttachment(){return this.shouldShowFilePicker&&this.hasAttachmentsEnabled&&this.userInput.length===0},showSendButton(){return this.userInput.length>0}},watch:{isWidgetOpen(e){e&&this.focusInput()}},unmounted(){document.removeEventListener("keypress",this.handleEnterKeyPress)},mounted(){document.addEventListener("keypress",this.handleEnterKeyPress),this.isWidgetOpen&&this.focusInput()},methods:{onBlur(){this.isFocused=!1},onFocus(){this.isFocused=!0},handleButtonClick(){this.userInput&&this.userInput.trim()&&this.onSendMessage(this.userInput),this.userInput="",this.focusInput()},handleEnterKeyPress(e){e.keyCode===13&&!e.shiftKey&&(e.preventDefault(),this.handleButtonClick())},toggleEmojiPicker(){this.showEmojiPicker=!this.showEmojiPicker},hideEmojiPicker(e){this.showEmojiPicker&&(e.stopPropagation(),this.toggleEmojiPicker())},emojiOnClick(e){this.userInput=`${this.userInput}${e} `},onTypingOff(){this.toggleTyping("off")},onTypingOn(){this.toggleTyping("on")},toggleTyping(e){this.$store.dispatch("conversation/toggleUserTyping",{typingStatus:e})},focusInput(){this.$refs.chatInput.focus()}}},qe={class:"flex items-center ltr:pl-2 rtl:pr-2"},Ge=["aria-label"];function Ye(e,n,s,u,i,t){const a=l("ResizableTextArea"),c=l("ChatAttachmentButton"),g=l("FluentIcon"),f=l("EmojiInput"),k=l("ChatSendButton"),R=U("on-clickaway");return o(),r("div",{class:v(["items-center flex ltr:pl-3 rtl:pr-3 ltr:pr-2 rtl:pl-2 rounded-[7px] transition-all duration-200 bg-n-background !shadow-[0_0_0_1px,0_0_2px_3px]",{"!shadow-n-brand dark:!shadow-n-brand":i.isFocused,"!shadow-n-strong dark:!shadow-n-strong":!i.isFocused}]),onKeydown:n[2]||(n[2]=D((...I)=>t.hideEmojiPicker&&t.hideEmojiPicker(...I),["esc"]))},[b(a,{id:"chat-input",ref:"chatInput",modelValue:i.userInput,"onUpdate:modelValue":n[0]||(n[0]=I=>i.userInput=I),rows:1,"aria-label":e.$t("CHAT_PLACEHOLDER"),placeholder:e.$t("CHAT_PLACEHOLDER"),class:"user-message-input reset-base",onTypingOff:t.onTypingOff,onTypingOn:t.onTypingOn,onFocus:t.onFocus,onBlur:t.onBlur},null,8,["modelValue","aria-label","placeholder","onTypingOff","onTypingOn","onFocus","onBlur"]),d("div",qe,[t.showAttachment?(o(),h(c,{key:0,class:"text-n-slate-12","on-attach":s.onSendAttachment},null,8,["on-attach"])):m("",!0),e.shouldShowEmojiPicker&&e.hasEmojiPickerEnabled?(o(),r("button",{key:1,class:"flex items-center justify-center min-h-8 min-w-8","aria-label":e.$t("EMOJI.ARIA_LABEL"),onClick:n[1]||(n[1]=(...I)=>t.toggleEmojiPicker&&t.toggleEmojiPicker(...I))},[b(g,{icon:"emoji",class:v(["transition-all duration-150",{"text-n-slate-12":!i.showEmojiPicker,"text-n-brand":i.showEmojiPicker}])},null,8,["class"])],8,Ge)):m("",!0),e.shouldShowEmojiPicker&&i.showEmojiPicker?x((o(),h(f,{key:2,"on-click":t.emojiOnClick,onKeydown:D(t.hideEmojiPicker,["esc"])},null,8,["on-click","onKeydown"])),[[R,t.hideEmojiPicker]]):m("",!0),t.showSendButton?(o(),h(k,{key:3,color:e.widgetColor,onClick:t.handleButtonClick},null,8,["color","onClick"])):m("",!0)])],34)}const Xe=p(He,[["render",Ye],["__scopeId","data-v-8bfb314d"]]),Ke={components:{ChatInputWrap:Xe,CustomButton:de,FooterReplyTo:Ue},setup(){return{router:fe()}},data(){return{inReplyTo:null}},computed:{...T({conversationAttributes:"conversationAttributes/getConversationParams",widgetColor:"appConfig/getWidgetColor",conversationSize:"conversation/getConversationSize",currentUser:"contacts/getCurrentUser",isWidgetStyleFlat:"appConfig/isWidgetStyleFlat"}),textColor(){return O(this.widgetColor)},hideReplyBox(){const{allowMessagesAfterResolved:e}=window.chatwootWebChannel,{status:n}=this.conversationAttributes;return!e&&n==="resolved"},showEmailTranscriptButton(){return this.hasEmail},hasEmail(){return this.currentUser&&this.currentUser.has_email},hasReplyTo(){return this.inReplyTo&&(this.inReplyTo.content||this.inReplyTo.attachments)}},mounted(){M.on(F.TOGGLE_REPLY_TO_MESSAGE,this.toggleReplyTo)},methods:{...W("conversation",["sendMessage","sendAttachment"]),...W("conversationAttributes",["getAttributes"]),async handleSendMessage(e){await this.sendMessage({content:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null,this.conversationSize===0&&this.getAttributes()},async handleSendAttachment(e){await this.sendAttachment({attachment:e,replyTo:this.inReplyTo?this.inReplyTo.id:null}),this.inReplyTo=null},startNewConversation(){this.router.replace({name:"prechat-form"}),z.sendMessage({event:"onEvent",eventIdentifier:ke,data:{hasConversation:!0}})},toggleReplyTo(e){this.inReplyTo=e},async sendTranscript(){if(this.hasEmail)try{await ye(),M.emit(F.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_SUCCESS"),type:"success"})}catch{M.$emit(F.SHOW_ALERT,{message:this.$t("EMAIL_TRANSCRIPT.SEND_EMAIL_ERROR")})}}}},Je={key:1};function Ze(e,n,s,u,i,t){const a=l("FooterReplyTo"),c=l("ChatInputWrap"),g=l("CustomButton");return t.hideReplyBox?(o(),r("div",Je,[b(g,{class:"font-medium",block:"","bg-color":e.widgetColor,"text-color":t.textColor,onClick:t.startNewConversation},{default:V(()=>[P(_(e.$t("START_NEW_CONVERSATION")),1)]),_:1},8,["bg-color","text-color","onClick"]),t.showEmailTranscriptButton?(o(),h(g,{key:0,type:"clear",class:"font-normal",onClick:t.sendTranscript},{default:V(()=>[P(_(e.$t("EMAIL_TRANSCRIPT.BUTTON_TEXT")),1)]),_:1},8,["onClick"])):m("",!0)])):(o(),r("footer",{key:0,class:v(["relative z-50 mb-1",{"rounded-lg":!e.isWidgetStyleFlat,"pt-2.5 shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.05)] dark:shadow-[0px_-20px_20px_1px_rgba(0,_0,_0,_0.15)] rounded-t-none":t.hasReplyTo}])},[t.hasReplyTo?(o(),h(a,{key:0,"in-reply-to":i.inReplyTo,onDismiss:n[0]||(n[0]=f=>i.inReplyTo=null)},null,8,["in-reply-to"])):m("",!0),b(c,{class:"shadow-sm","on-send-message":t.handleSendMessage,"on-send-attachment":t.handleSendAttachment},null,8,["on-send-message","on-send-attachment"])],2))}const Qe=p(Ke,[["render",Ze]]),et={name:"UserMessageBubble",props:{message:{type:String,default:""},widgetColor:{type:String,default:""}},setup(){const{formatMessage:e}=j();return{formatMessage:e}},computed:{textColor(){return O(this.widgetColor)}}};function tt(e,n,s,u,i,t){const a=U("dompurify-html");return x((o(),r("div",{class:"chat-bubble user",style:C({background:s.widgetColor,color:t.textColor})},null,4)),[[a,u.formatMessage(s.message,!1)]])}const st=p(et,[["render",tt],["__scopeId","data-v-651a0452"]]),nt={name:"MessageReplyButton",components:{FluentIcon:w}},ot={class:"p-1 mb-1 rounded-full text-n-slate-11 bg-n-slate-3 hover:text-n-slate-12"};function at(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("button",ot,[b(a,{icon:"arrow-reply",size:"11",class:"flex-shrink-0"})])}const Q=p(nt,[["render",at]]),rt={props:{url:{type:String,default:""},thumb:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],methods:{onImgError(){this.$emit("error")}}},it=["href"],lt={class:"wrap"},dt=["src"],ct={class:"time"};function ut(e,n,s,u,i,t){return o(),r("a",{href:s.url,target:"_blank",rel:"noreferrer noopener nofollow",class:"image"},[d("div",lt,[d("img",{src:s.thumb,alt:"Picture message",onError:n[0]||(n[0]=(...a)=>t.onImgError&&t.onImgError(...a))},null,40,dt),d("span",ct,_(s.readableTime),1)])],8,it)}const ee=p(rt,[["render",ut],["__scopeId","data-v-f077030b"]]),mt={class:"relative block max-w-full"},ht=["src"],gt={class:"absolute text-xs text-white dark:text-white right-3 bottom-1 whitespace-nowrap"},te={__name:"VideoBubble",props:{url:{type:String,default:""},readableTime:{type:String,default:""}},emits:["error"],setup(e,{emit:n}){const s=n,u=()=>{s("error")};return(i,t)=>(o(),r("div",mt,[d("video",{class:"w-full max-w-[250px] h-auto",src:e.url,controls:"",onError:u},null,40,ht),d("span",gt,_(e.readableTime),1)]))}},pt={components:{FluentIcon:w},props:{url:{type:String,default:""},isInProgress:{type:Boolean,default:!1},widgetColor:{type:String,default:""},isUserBubble:{type:Boolean,default:!1}},computed:{title(){return this.isInProgress?this.$t("COMPONENTS.FILE_BUBBLE.UPLOADING"):decodeURI(this.fileName)},fileName(){return this.url.substring(this.url.lastIndexOf("/")+1)},contrastingTextColor(){return O(this.widgetColor)},textColor(){return this.isUserBubble&&this.widgetColor?this.contrastingTextColor:""}},methods:{openLink(){window.open(this.url,"_blank").focus()}}},_t={class:"file flex flex-row items-center p-3 cursor-pointer"},bt={class:"ltr:pr-1 rtl:pl-1"},ft={class:"leading-none mb-1"},yt=["href"];function Ct(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",_t,[d("div",{class:"icon-wrap",style:C({color:t.textColor})},[b(a,{icon:"document",size:"28"})],4),d("div",bt,[d("div",{class:v(["m-0 font-medium text-sm",{"text-n-slate-12":!s.isUserBubble}]),style:C({color:t.textColor})},_(t.title),7),d("div",ft,[d("a",{class:"download",rel:"noreferrer noopener nofollow",target:"_blank",style:C({color:t.textColor}),href:s.url},_(e.$t("COMPONENTS.FILE_BUBBLE.DOWNLOAD")),13,yt)])])])}const se=p(pt,[["render",Ct],["__scopeId","data-v-7ea48b19"]]),ne={computed:{messageContentAttributes(){const{content_attributes:e={}}=this.message;return e},hasAttachments(){return!!(this.message.attachments&&this.message.attachments.length>0)}}},vt={name:"AgentMessage",components:{FluentIcon:w},props:{replyTo:{type:Object,default:()=>{}}},data(){return{timeOutID:null}},computed:{replyToAttachment(){var n,s;if(!((s=(n=this.replyTo)==null?void 0:n.attachments)!=null&&s.length))return"";const[{file_type:e}={}]=this.replyTo.attachments;return this.$t(`ATTACHMENTS.${e}.CONTENT`)}},unmounted(){clearTimeout(this.timeOutID)},methods:{navigateTo(e){const n=`cwmsg-${e}`;this.$nextTick(()=>{const s=document.getElementById(n);s.scrollIntoView(),s.classList.add("bg-n-slate-3","dark:bg-n-solid-3"),this.timeOutID=setTimeout(()=>{s.classList.remove("bg-n-slate-3","dark:bg-n-solid-3")},500)})}}},Tt={class:"truncate max-w-[8rem]"};function kt(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("button",{class:"px-1.5 py-0.5 rounded-md text-n-slate-11 bg-n-slate-4 opacity-60 hover:opacity-100 cursor-pointer flex items-center gap-1.5",onClick:n[0]||(n[0]=c=>t.navigateTo(s.replyTo.id))},[b(a,{icon:"arrow-reply",size:"12",class:"flex-shrink-0"}),d("div",Tt,_(s.replyTo.content||t.replyToAttachment),1)])}const oe=p(vt,[["render",kt]]),St={name:"DragWrapper",props:{direction:{type:String,required:!0,validator:e=>["left","right"].includes(e)},disabled:{type:Boolean,default:!1}},emits:["dragged"],data(){return{startX:null,dragDistance:0,threshold:50}},methods:{handleTouchStart(e){this.disabled||(this.startX=e.touches[0].clientX)},handleTouchMove(e){if(this.disabled)return;let s=e.touches[0].clientX-this.startX;this.direction==="right"?this.dragDistance=Math.min(this.threshold,s):this.direction==="left"&&(this.dragDistance=Math.max(-this.threshold,s))},resetPosition(){(this.dragDistance>=this.threshold&&this.direction==="right"||this.dragDistance<=-this.threshold&&this.direction==="left")&&this.$emit("dragged",this.direction),this.dragDistance=0}}};function Et(e,n,s,u,i,t){return o(),r("div",{style:C({transform:`translateX(${i.dragDistance}px)`}),class:"will-change-transform",onTouchstart:n[0]||(n[0]=(...a)=>t.handleTouchStart&&t.handleTouchStart(...a)),onTouchmove:n[1]||(n[1]=(...a)=>t.handleTouchMove&&t.handleTouchMove(...a)),onTouchend:n[2]||(n[2]=(...a)=>t.resetPosition&&t.resetPosition(...a))},[ce(e.$slots,"default")],36)}const At=p(St,[["render",Et]]),wt={name:"UserMessage",components:{UserMessageBubble:st,MessageReplyButton:Q,ImageBubble:ee,VideoBubble:te,FileBubble:se,FluentIcon:w,ReplyToChip:oe,DragWrapper:At},mixins:[ne],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),isInProgress(){const{status:e=""}=this.message;return e==="in_progress"},showTextBubble(){const{message:e}=this;return!!e.content},readableTime(){const{created_at:e=""}=this.message;return K(e)},isFailed(){const{status:e=""}=this.message;return e==="failed"},errorMessage(){const{meta:e}=this.message;return e?e.error:this.$t("COMPONENTS.MESSAGE_BUBBLE.ERROR_MESSAGE")},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{async retrySendMessage(){await this.$store.dispatch("conversation/sendMessageWithData",this.message)},onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){M.emit(F.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},It={class:"user-message-wrap group"},xt={class:"flex gap-1 user-message"},Rt={key:0,class:"flex justify-end mt-2 mb-1 text-xs"},Mt={class:"flex justify-end gap-1"},Ft={class:"flex flex-col justify-end"},Ot={key:1,class:"flex justify-end px-4 py-2 text-n-ruby-9 align-middle"},Lt=["title"];function Bt(e,n,s,u,i,t){const a=l("ReplyToChip"),c=l("MessageReplyButton"),g=l("UserMessageBubble"),f=l("ImageBubble"),k=l("VideoBubble"),R=l("FileBubble"),I=l("DragWrapper"),L=l("FluentIcon");return o(),r("div",It,[d("div",xt,[d("div",{class:v(["message-wrap",{"in-progress":t.isInProgress,"is-failed":t.isFailed}])},[t.hasReplyTo?(o(),r("div",Rt,[b(a,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("",!0),d("div",Mt,[d("div",Ft,[!t.isInProgress&&!t.isFailed?(o(),h(c,{key:0,class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])):m("",!0)]),b(I,{direction:"left",onDragged:t.toggleReply},{default:V(()=>[t.showTextBubble?(o(),h(g,{key:0,message:s.message.content,status:s.message.status,"widget-color":e.widgetColor},null,8,["message","status","widget-color"])):m("",!0),e.hasAttachments?(o(),r("div",{key:1,class:"chat-bubble has-attachment user",style:C({backgroundColor:e.widgetColor})},[(o(!0),r(E,null,A(s.message.attachments,y=>(o(),r("div",{key:y.id},[y.file_type==="image"&&!i.hasImageError?(o(),h(f,{key:0,url:y.data_url,thumb:y.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("",!0),y.file_type==="video"&&!i.hasVideoError?(o(),h(k,{key:1,url:y.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):(o(),h(R,{key:2,url:y.data_url,"is-in-progress":t.isInProgress,"widget-color":e.widgetColor,"is-user-bubble":""},null,8,["url","is-in-progress","widget-color"]))]))),128))],4)):m("",!0)]),_:1},8,["onDragged"])]),t.isFailed?(o(),r("div",Ot,[e.hasAttachments?m("",!0):(o(),r("button",{key:0,title:e.$t("COMPONENTS.MESSAGE_BUBBLE.RETRY"),class:"inline-flex items-center justify-center ltr:ml-2 rtl:mr-2",onClick:n[0]||(n[0]=(...y)=>t.retrySendMessage&&t.retrySendMessage(...y))},[b(L,{icon:"arrow-clockwise",size:"14"})],8,Lt))])):m("",!0)],2)])])}const ae=p(wt,[["render",Bt]]),Ut={components:{},props:{action:{type:Object,default:()=>{}}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},isLink(){return this.action.type==="link"}},methods:{onClick(){this.action.type==="postback"&&z.isIFrame()&&z.sendMessage({event:"postback",data:{payload:this.action.payload}})}}},Pt=["href"];function Vt(e,n,s,u,i,t){return t.isLink?(o(),r("a",{key:s.action.uri,class:"action-button button",href:s.action.uri,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),target:"_blank",rel:"noopener nofollow noreferrer"},_(s.action.text),13,Pt)):(o(),r("button",{key:s.action.payload,class:"action-button button !bg-n-background dark:!bg-n-alpha-black1 text-n-brand",style:C({borderColor:e.widgetColor,color:e.widgetColor}),onClick:n[0]||(n[0]=(...a)=>t.onClick&&t.onClick(...a))},_(s.action.text),5))}const Dt=p(Ut,[["render",Vt],["__scopeId","data-v-eccbcf5d"]]),jt={components:{CardButton:Dt},props:{title:{type:String,default:""},description:{type:String,default:""},mediaUrl:{type:String,default:""},actions:{type:Array,default:()=>[]}}},$t={class:"card-message chat-bubble agent bg-n-background dark:bg-n-solid-3 max-w-56 rounded-lg overflow-hidden"},Nt=["src"],Wt={class:"card-body"},zt={class:"!text-base !font-medium !mt-1 !mb-1 !leading-[1.5] text-n-slate-12"},Ht={class:"!mb-1 text-n-slate-11"};function qt(e,n,s,u,i,t){const a=l("CardButton");return o(),r("div",$t,[d("img",{class:"w-full object-contain max-h-[150px] rounded-[5px]",src:s.mediaUrl},null,8,Nt),d("div",Wt,[d("h4",zt,_(s.title),1),d("p",Ht,_(s.description),1),(o(!0),r(E,null,A(s.actions,c=>(o(),h(a,{key:c.id,action:c},null,8,["action"]))),128))])])}const Gt=p(jt,[["render",qt]]),Yt={props:{buttonLabel:{type:String,default:""},items:{type:Array,default:()=>[]},submittedValues:{type:Array,default:()=>[]}},emits:["submit"],data(){return{formValues:{},hasSubmitted:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},isFormValid(){return this.items.reduce((e,{name:n})=>!!this.formValues[n]&&e,!0)}},mounted(){this.submittedValues.length?this.updateFormValues():this.setFormDefaults()},methods:{onSubmitClick(){this.hasSubmitted=!0},onSubmit(){this.isFormValid&&this.$emit("submit",this.formValues)},buildFormObject(e){return e.reduce((n,s)=>({...n,[s.name]:s.value||s.default}),{})},updateFormValues(){this.formValues=this.buildFormObject(this.submittedValues)},setFormDefaults(){this.formValues=this.buildFormObject(this.items)}}},Xt={class:"form chat-bubble agent w-full p-4 bg-n-background dark:bg-n-solid-3"},Kt={class:"text-n-slate-12"},Jt=["onUpdate:modelValue","type","pattern","title","required","name","placeholder","disabled"],Zt=["onUpdate:modelValue","required","pattern","title","type","name","placeholder","disabled"],Qt=["onUpdate:modelValue","required","title","name","placeholder","disabled"],es=["onUpdate:modelValue","required"],ts=["value"],ss={class:"error-message"};function ns(e,n,s,u,i,t){return o(),r("div",Xt,[d("form",{onSubmit:n[1]||(n[1]=q((...a)=>t.onSubmit&&t.onSubmit(...a),["prevent"]))},[(o(!0),r(E,null,A(s.items,a=>(o(),r("div",{key:a.key,class:v(["pb-2 w-full",{"has-submitted":i.hasSubmitted}])},[d("label",Kt,_(a.label),1),a.type==="email"?x((o(),r("input",{key:0,"onUpdate:modelValue":c=>i.formValues[a.name]=c,type:a.type,pattern:a.regex,title:a.title,required:a.required&&"required",name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,Jt)),[[Y,i.formValues[a.name]]]):a.type==="text"?x((o(),r("input",{key:1,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required",pattern:a.pattern,title:a.title,type:a.type,name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,Zt)),[[Y,i.formValues[a.name]]]):a.type==="text_area"?x((o(),r("textarea",{key:2,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required",title:a.title,name:a.name,placeholder:a.placeholder,disabled:!!s.submittedValues.length},null,8,Qt)),[[H,i.formValues[a.name]]]):a.type==="select"?x((o(),r("select",{key:3,"onUpdate:modelValue":c=>i.formValues[a.name]=c,required:a.required&&"required"},[(o(!0),r(E,null,A(a.options,c=>(o(),r("option",{key:c.key,value:c.value},_(c.label),9,ts))),128))],8,es)),[[ue,i.formValues[a.name]]]):m("",!0),d("span",ss,_(a.pattern_error||e.$t("CHAT_FORM.INVALID.FIELD")),1)],2))),128)),s.submittedValues.length?m("",!0):(o(),r("button",{key:0,class:"button block",type:"submit",style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...a)=>t.onSubmitClick&&t.onSubmitClick(...a))},_(s.buttonLabel||e.$t("COMPONENTS.FORM_BUBBLE.SUBMIT")),5))],32)])}const os=p(Yt,[["render",ns],["__scopeId","data-v-663a5cdb"]]),as={components:{},props:{action:{type:Object,default:()=>{}},isSelected:{type:Boolean,default:!1}},emits:["optionSelect"],computed:{...T({widgetColor:"appConfig/getWidgetColor"})},methods:{onClick(){this.$emit("optionSelect",this.action)}}};function rs(e,n,s,u,i,t){return o(),r("li",{class:v(["option",{"is-selected":s.isSelected}]),style:C({borderColor:e.widgetColor})},[d("button",{class:"option-button button",onClick:n[0]||(n[0]=(...a)=>t.onClick&&t.onClick(...a))},[d("span",{style:C({color:e.widgetColor})},_(s.action.title),5)])],6)}const is=p(as,[["render",rs],["__scopeId","data-v-74ee74cc"]]),ls={components:{ChatOption:is},props:{title:{type:String,default:""},options:{type:Array,default:()=>[]},selected:{type:String,default:""},hideFields:{type:Boolean,default:!1}},emits:["optionSelect"],setup(){const{formatMessage:e}=j();return{formatMessage:e}},methods:{isSelected(e){return this.selected===e.id},onClick(e){this.$emit("optionSelect",e)}}},ds={class:"chat-bubble agent max-w-64 !py-2 !px-4 rounded-lg overflow-hidden mt-1 bg-n-background dark:bg-n-solid-3"},cs={class:"text-n-slate-12 text-sm font-normal my-1 leading-[1.5]"},us={class:"text-n-slate-12"},ms={key:0,class:"w-full"};function hs(e,n,s,u,i,t){const a=l("ChatOption"),c=U("dompurify-html");return o(),r("div",ds,[d("h4",cs,[x(d("div",us,null,512),[[c,u.formatMessage(s.title,!1)]])]),s.hideFields?m("",!0):(o(),r("ul",ms,[(o(!0),r(E,null,A(s.options,g=>(o(),h(a,{key:g.id,action:g,"is-selected":t.isSelected(g),class:"list-none p-0",onOptionSelect:t.onClick},null,8,["action","is-selected","onOptionSelect"]))),128))]))])}const gs=p(ls,[["render",hs]]),ps={components:{FluentIcon:w},props:{items:{type:Array,default:()=>[]}},setup(){const{truncateMessage:e}=j();return{truncateMessage:e}}},_s={key:0,class:"chat-bubble agent bg-n-background dark:bg-n-solid-3"},bs=["href"],fs={class:"flex items-center text-n-slate-12 font-medium"},ys={class:"text-n-slate-12"},Cs={class:"block mt-1 text-n-slate-12"};function vs(e,n,s,u,i,t){const a=l("FluentIcon");return s.items.length?(o(),r("div",_s,[(o(!0),r(E,null,A(s.items,c=>(o(),r("div",{key:c.link,class:"border-b border-solid border-n-weak text-sm py-2 px-0 last:border-b-0"},[d("a",{href:c.link,target:"_blank",rel:"noopener noreferrer nofollow",class:"text-n-slate-12 no-underline"},[d("span",fs,[b(a,{icon:"link",class:"ltr:mr-1 rtl:ml-1 text-n-slate-12"}),d("span",ys,_(c.title),1)]),d("span",Cs,_(u.truncateMessage(c.description)),1)],8,bs)]))),128))])):m("",!0)}const Ts=p(ps,[["render",vs]]),ks={components:{FluentIcon:w,Spinner:B},props:{messageId:{type:Number,required:!0},messageContentAttributes:{type:Object,default:()=>{}}},setup(){return{v$:we()}},data(){return{email:"",isUpdating:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},hasSubmitted(){return this.messageContentAttributes&&this.messageContentAttributes.submitted_email}},validations:{email:{required:Ae,email:Ee}},methods:{async onSubmit(){if(!this.v$.$invalid){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{email:this.email,messageId:this.messageId})}catch{}finally{this.isUpdating=!1}}}}},Ss=["placeholder"],Es=["disabled"];function As(e,n,s,u,i,t){const a=l("FluentIcon"),c=l("Spinner");return o(),r("div",null,[t.hasSubmitted?m("",!0):(o(),r("form",{key:0,class:"email-input-group h-10 flex my-2 mx-0 min-w-[200px]",onSubmit:n[3]||(n[3]=q((...g)=>t.onSubmit&&t.onSubmit(...g),["prevent"]))},[x(d("input",{"onUpdate:modelValue":n[0]||(n[0]=g=>i.email=g),type:"email",placeholder:e.$t("EMAIL_PLACEHOLDER"),class:v({error:u.v$.email.$error}),onInput:n[1]||(n[1]=(...g)=>u.v$.email.$touch&&u.v$.email.$touch(...g)),onKeydown:n[2]||(n[2]=D((...g)=>t.onSubmit&&t.onSubmit(...g),["enter"]))},null,42,Ss),[[H,i.email]]),d("button",{class:"button small",disabled:u.v$.email.$invalid,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating?(o(),h(c,{key:1,class:"mx-2"})):(o(),h(a,{key:0,icon:"chevron-right"}))],12,Es)],32))])}const ws=p(ks,[["render",As],["__scopeId","data-v-c0f153df"]]),Is={components:{Spinner:B,FluentIcon:w,StarRating:Ie},props:{messageContentAttributes:{type:Object,default:()=>{}},messageId:{type:Number,required:!0},displayType:{type:String,default:N.EMOJI},message:{type:String,default:""}},data(){return{email:"",ratings:ie,selectedRating:null,isUpdating:!1,feedback:""}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),isRatingSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.rating},isFeedbackSubmitted(){var e,n;return(n=(e=this.messageContentAttributes)==null?void 0:e.csat_survey_response)==null?void 0:n.feedback_message},isButtonDisabled(){return!(this.selectedRating&&this.feedback)},textColor(){return O(this.widgetColor)},title(){return this.isRatingSubmitted?this.$t("CSAT.SUBMITTED_TITLE"):this.message||this.$t("CSAT.TITLE")},isEmojiType(){return this.displayType===N.EMOJI},isStarType(){return this.displayType===N.STAR}},mounted(){if(this.isRatingSubmitted){const{csat_survey_response:{rating:e,feedback_message:n}}=this.messageContentAttributes;this.selectedRating=e,this.feedback=n}},methods:{buttonClass(e){return[{selected:e.value===this.selectedRating},{disabled:this.isRatingSubmitted},{hover:this.isRatingSubmitted},"emoji-button"]},async onSubmit(){this.isUpdating=!0;try{await this.$store.dispatch("message/update",{submittedValues:{csat_survey_response:{rating:this.selectedRating,feedback_message:this.feedback}},messageId:this.messageId})}catch{}finally{this.isUpdating=!1}},selectRating(e){this.selectedRating=e.value,this.onSubmit()},selectStarRating(e){this.selectedRating=e,this.onSubmit()}}},xs={class:"text-n-slate-12 text-sm font-medium pt-5 px-2.5 text-center"},Rs={key:0,class:"ratings flex justify-around py-5 px-4"},Ms=["onClick"],Fs=["placeholder"],Os=["disabled"];function Ls(e,n,s,u,i,t){const a=l("StarRating"),c=l("Spinner"),g=l("FluentIcon");return o(),r("div",{class:"customer-satisfaction w-full bg-n-background dark:bg-n-solid-3 shadow-[0_0.25rem_6px_rgba(50,50,93,0.08),0_1px_3px_rgba(0,0,0,0.05)] ltr:rounded-bl-[0.25rem] rtl:rounded-br-[0.25rem] rounded-lg inline-block leading-[1.5] mt-1 border-t-2 border-t-n-brand border-solid",style:C({borderColor:e.widgetColor})},[d("h6",xs,_(t.title),1),t.isEmojiType?(o(),r("div",Rs,[(o(!0),r(E,null,A(i.ratings,f=>(o(),r("button",{key:f.key,class:v(t.buttonClass(f)),onClick:k=>t.selectRating(f)},_(f.emoji),11,Ms))),128))])):t.isStarType?(o(),h(a,{key:1,"selected-rating":i.selectedRating,"is-disabled":t.isRatingSubmitted,onSelectRating:t.selectStarRating},null,8,["selected-rating","is-disabled","onSelectRating"])):m("",!0),t.isFeedbackSubmitted?m("",!0):(o(),r("form",{key:2,class:"feedback-form flex",onSubmit:n[2]||(n[2]=q(f=>t.onSubmit(),["prevent"]))},[x(d("input",{"onUpdate:modelValue":n[0]||(n[0]=f=>i.feedback=f),placeholder:e.$t("CSAT.PLACEHOLDER"),onKeydown:n[1]||(n[1]=D((...f)=>t.onSubmit&&t.onSubmit(...f),["enter"]))},null,40,Fs),[[H,i.feedback]]),d("button",{class:"button small",disabled:t.isButtonDisabled,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor})},[i.isUpdating&&i.feedback?(o(),h(c,{key:0})):(o(),h(g,{key:1,icon:"chevron-right"}))],12,Os)],32))],4)}const Bs=p(Is,[["render",Ls],["__scopeId","data-v-233c99da"]]),Us={addParticipantToDyteMeeting:e=>{const s={url:`/api/v1/widget/integrations/dyte/add_participant_to_meeting${Se(window.location.search)}`};return Ce.post(s.url,{message_id:e})}},Ps={components:{FluentIcon:w},props:{messageId:{type:Number,required:!0}},data(){return{isLoading:!1,dyteAuthToken:"",isSDKMounted:!1}},computed:{...T({widgetColor:"appConfig/getWidgetColor"}),textColor(){return O(this.widgetColor)},meetingLink(){return _e(this.dyteAuthToken)}},methods:{async joinTheCall(){this.isLoading=!0;try{const e=await Us.addParticipantToDyteMeeting(this.messageId),{data:{token:n}={}}=e;this.dyteAuthToken=n}catch{}finally{this.isLoading=!1}},leaveTheRoom(){this.dyteAuthToken=""}}},Vs=["is-loading"],Ds={key:0,class:"video-call--container"},js=["src"];function $s(e,n,s,u,i,t){const a=l("FluentIcon");return o(),r("div",null,[d("button",{class:"button join-call-button","color-scheme":"secondary","is-loading":i.isLoading,style:C({background:e.widgetColor,borderColor:e.widgetColor,color:t.textColor}),onClick:n[0]||(n[0]=(...c)=>t.joinTheCall&&t.joinTheCall(...c))},[b(a,{icon:"video-add",class:"rtl:ml-2 ltr:mr-2"}),P(" "+_(e.$t("INTEGRATIONS.DYTE.CLICK_HERE_TO_JOIN")),1)],12,Vs),i.dyteAuthToken?(o(),r("div",Ds,[d("iframe",{src:t.meetingLink,allow:"camera;microphone;fullscreen;display-capture;picture-in-picture;clipboard-write;"},null,8,js),d("button",{class:"button small join-call-button leave-room-button",onClick:n[1]||(n[1]=(...c)=>t.leaveTheRoom&&t.leaveTheRoom(...c))},_(e.$t("INTEGRATIONS.DYTE.LEAVE_THE_ROOM")),1)])):m("",!0)])}const Ns=p(Ps,[["render",$s],["__scopeId","data-v-9ee75e88"]]),Ws={name:"AgentMessageBubble",components:{ChatArticle:Ts,ChatCard:Gt,ChatForm:os,ChatOptions:gs,EmailInput:ws,CustomerSatisfaction:Bs,IntegrationCard:Ns},props:{message:{type:String,default:null},contentType:{type:String,default:null},messageType:{type:Number,default:null},messageId:{type:Number,default:null},messageContentAttributes:{type:Object,default:()=>{}}},setup(){const{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:u}=j();return{formatMessage:e,getPlainText:n,truncateMessage:s,highlightContent:u}},computed:{isTemplate(){return this.messageType===3},isTemplateEmail(){return this.contentType==="input_email"},isCards(){return this.contentType==="cards"},isOptions(){return this.contentType==="input_select"},isForm(){return this.contentType==="form"},isArticle(){return this.contentType==="article"},isCSAT(){return this.contentType==="input_csat"},isIntegrations(){return this.contentType==="integrations"}},methods:{onResponse(e){this.$store.dispatch("message/update",e)},onOptionSelect(e){this.onResponse({submittedValues:[e],messageId:this.messageId})},onFormSubmit(e){const n=Object.keys(e).map(s=>({name:s,value:e[s]}));this.onResponse({submittedValues:n,messageId:this.messageId})}}},zs={class:"chat-bubble-wrap"},Hs={key:0,class:"chat-bubble agent bg-n-background dark:bg-n-solid-3 text-n-slate-12"},qs={class:"message-content text-n-slate-12"},Gs={key:1},Ys={key:3},Xs={key:4};function Ks(e,n,s,u,i,t){const a=l("EmailInput"),c=l("IntegrationCard"),g=l("ChatOptions"),f=l("ChatForm"),k=l("ChatCard"),R=l("ChatArticle"),I=l("CustomerSatisfaction"),L=U("dompurify-html");return o(),r("div",zs,[!t.isCards&&!t.isOptions&&!t.isForm&&!t.isArticle&&!t.isCards&&!t.isCSAT?(o(),r("div",Hs,[x(d("div",qs,null,512),[[L,u.formatMessage(s.message,!1)]]),t.isTemplateEmail?(o(),h(a,{key:0,"message-id":s.messageId,"message-content-attributes":s.messageContentAttributes},null,8,["message-id","message-content-attributes"])):m("",!0),t.isIntegrations?(o(),h(c,{key:1,"message-id":s.messageId,"meeting-data":s.messageContentAttributes.data},null,8,["message-id","meeting-data"])):m("",!0)])):m("",!0),t.isOptions?(o(),r("div",Gs,[b(g,{title:s.message,options:s.messageContentAttributes.items,"hide-fields":!!s.messageContentAttributes.submitted_values,onOptionSelect:t.onOptionSelect},null,8,["title","options","hide-fields","onOptionSelect"])])):m("",!0),t.isForm&&!s.messageContentAttributes.submitted_values?(o(),h(f,{key:2,items:s.messageContentAttributes.items,"button-label":s.messageContentAttributes.button_label,"submitted-values":s.messageContentAttributes.submitted_values,onSubmit:t.onFormSubmit},null,8,["items","button-label","submitted-values","onSubmit"])):m("",!0),t.isCards?(o(),r("div",Ys,[(o(!0),r(E,null,A(s.messageContentAttributes.items,y=>(o(),h(k,{key:y.title,"media-url":y.media_url,title:y.title,description:y.description,actions:y.actions},null,8,["media-url","title","description","actions"]))),128))])):m("",!0),t.isArticle?(o(),r("div",Xs,[b(R,{items:s.messageContentAttributes.items},null,8,["items"])])):m("",!0),t.isCSAT?(o(),h(I,{key:5,"message-content-attributes":s.messageContentAttributes.submitted_values,"display-type":s.messageContentAttributes.display_type,message:s.message,"message-id":s.messageId},null,8,["message-content-attributes","display-type","message","message-id"])):m("",!0)])}const Js=p(Ws,[["render",Ks]]),Zs={name:"AgentMessage",components:{AgentMessageBubble:Js,ImageBubble:ee,VideoBubble:te,Avatar:xe,UserMessage:ae,FileBubble:se,MessageReplyButton:Q,ReplyToChip:oe},mixins:[J,ne],props:{message:{type:Object,default:()=>{}},replyTo:{type:Object,default:()=>{}}},data(){return{hasImageError:!1,hasVideoError:!1}},computed:{shouldDisplayAgentMessage(){return this.contentType==="input_select"&&this.messageContentAttributes.submitted_values&&!this.message.content?!1:this.message.content},readableTime(){const{created_at:e=""}=this.message;return K(e,"LLL d yyyy, h:mm a")},messageType(){const{message_type:e=1}=this.message;return e},contentType(){const{content_type:e=""}=this.message;return e},agentName(){return this.message.sender?this.message.sender.available_name||this.message.sender.name:this.useInboxAvatarForBot?this.channelConfig.websiteName:this.$t("UNREAD_VIEW.BOT")},avatarUrl(){const e=this.useInboxAvatarForBot?this.inboxAvatarUrl:"/assets/images/chatwoot_bot.png";return this.message.message_type===Z.TEMPLATE?e:this.message.sender?this.message.sender.avatar_url:e},hasRecordedResponse(){return this.messageContentAttributes.submitted_email||this.messageContentAttributes.submitted_values&&!["form","input_csat"].includes(this.contentType)},responseMessage(){if(this.messageContentAttributes.submitted_email)return{content:this.messageContentAttributes.submitted_email};if(this.messageContentAttributes.submitted_values&&this.contentType==="input_select"){const[e={}]=this.messageContentAttributes.submitted_values;return{content:e.title||e.value}}return""},isASubmittedForm(){return Re(this.message)},submittedFormValues(){return this.messageContentAttributes.submitted_values.map(e=>({id:e.name,content:e.value}))},wrapClass(){return{"has-text":this.shouldDisplayAgentMessage}},hasReplyTo(){return this.replyTo&&(this.replyTo.content||this.replyTo.attachments)}},watch:{message(){this.hasImageError=!1,this.hasVideoError=!1}},mounted(){this.hasImageError=!1,this.hasVideoError=!1},methods:{onImageLoadError(){this.hasImageError=!0},onVideoLoadError(){this.hasVideoError=!0},toggleReply(){M.emit(F.TOGGLE_REPLY_TO_MESSAGE,this.message)}}},Qs={key:0,class:"agent-message"},en={class:"avatar-wrap"},tn={class:"user-thumbnail-box"},sn={class:"message-wrap"},nn={key:0,class:"flex mt-2 mb-1 text-xs"},on={class:"flex w-full gap-1"},an={key:2,controls:"",class:"h-10 dark:invert"},rn=["src"],ln={class:"flex flex-col justify-end"},dn={key:1,class:"agent-name text-n-slate-11"},cn={key:2};function un(e,n,s,u,i,t){var G;const a=l("Avatar"),c=l("ReplyToChip"),g=l("AgentMessageBubble"),f=l("ImageBubble"),k=l("VideoBubble"),R=l("FileBubble"),I=l("MessageReplyButton"),L=l("UserMessage"),y=U("dompurify-html");return o(),r("div",{class:v(["agent-message-wrap group",{"has-response":t.hasRecordedResponse||t.isASubmittedForm}])},[t.isASubmittedForm?m("",!0):(o(),r("div",Qs,[d("div",en,[d("div",tn,[s.message.showAvatar||t.hasRecordedResponse?(o(),h(a,{key:0,src:t.avatarUrl,size:24,name:t.agentName,"rounded-full":""},null,8,["src","name"])):m("",!0)])]),d("div",sn,[t.hasReplyTo?(o(),r("div",nn,[b(c,{"reply-to":s.replyTo},null,8,["reply-to"])])):m("",!0),d("div",on,[d("div",{class:v(["space-y-2",{"w-full":t.contentType==="form"&&!((G=e.messageContentAttributes)!=null&&G.submitted_values)}])},[t.shouldDisplayAgentMessage?(o(),h(g,{key:0,"content-type":t.contentType,"message-content-attributes":e.messageContentAttributes,"message-id":s.message.id,"message-type":t.messageType,message:s.message.content},null,8,["content-type","message-content-attributes","message-id","message-type","message"])):m("",!0),e.hasAttachments?(o(),r("div",{key:1,class:v(["space-y-2 chat-bubble has-attachment agent bg-n-background dark:bg-n-solid-3",t.wrapClass])},[(o(!0),r(E,null,A(s.message.attachments,S=>(o(),r("div",{key:S.id},[S.file_type==="image"&&!i.hasImageError?(o(),h(f,{key:0,url:S.data_url,thumb:S.data_url,"readable-time":t.readableTime,onError:t.onImageLoadError},null,8,["url","thumb","readable-time","onError"])):m("",!0),S.file_type==="video"&&!i.hasVideoError?(o(),h(k,{key:1,url:S.data_url,"readable-time":t.readableTime,onError:t.onVideoLoadError},null,8,["url","readable-time","onError"])):S.file_type==="audio"?(o(),r("audio",an,[d("source",{src:S.data_url},null,8,rn)])):(o(),h(R,{key:3,url:S.data_url},null,8,["url"]))]))),128))],2)):m("",!0)],2),d("div",ln,[b(I,{class:"transition-opacity delay-75 opacity-0 group-hover:opacity-100 sm:opacity-0",onClick:t.toggleReply},null,8,["onClick"])])]),s.message.showAvatar||t.hasRecordedResponse?x((o(),r("p",dn,null,512)),[[y,t.agentName]]):m("",!0)])])),t.hasRecordedResponse?(o(),h(L,{key:1,message:t.responseMessage},null,8,["message"])):m("",!0),t.isASubmittedForm?(o(),r("div",cn,[(o(!0),r(E,null,A(t.submittedFormValues,S=>(o(),h(L,{key:S.id,message:S},null,8,["message"]))),128))])):m("",!0)],2)}const mn=p(Zs,[["render",un]]),hn={components:{AgentMessage:mn,UserMessage:ae},props:{message:{type:Object,default:()=>{}}},computed:{...T({allMessages:"conversation/getConversation"}),isUserMessage(){return this.message.message_type===Z.INCOMING},replyTo(){var n,s;const e=(s=(n=this.message)==null?void 0:n.content_attributes)==null?void 0:s.in_reply_to;return e?this.allMessages[e]:null}}};function gn(e,n,s,u,i,t){const a=l("UserMessage"),c=l("AgentMessage");return t.isUserMessage?(o(),h(a,{key:0,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"])):(o(),h(c,{key:1,id:`cwmsg-${s.message.id}`,message:s.message,"reply-to":t.replyTo},null,8,["id","message","reply-to"]))}const pn=p(hn,[["render",gn],["__scopeId","data-v-41d8b669"]]),_n={name:"AgentTypingBubble"},bn={class:"agent-message-wrap sticky bottom-1"};function fn(e,n,s,u,i,t){return o(),r("div",bn,n[0]||(n[0]=[me('<div class="agent-message" data-v-718caf0a><div class="avatar-wrap" data-v-718caf0a></div><div class="message-wrap mt-2" data-v-718caf0a><div class="chat-bubble agent typing-bubble bg-n-background dark:bg-n-solid-3" data-v-718caf0a><img src="'+be+'" alt="Agent is typing a message" class="!w-full" data-v-718caf0a></div></div></div>',1)]))}const yn=p(_n,[["render",fn],["__scopeId","data-v-718caf0a"]]),Cn={props:{date:{type:String,required:!0}},computed:{formattedDate(){return Me({date:this.date,todayText:this.$t("TODAY"),yesterdayText:this.$t("YESTERDAY")})}}},vn={class:"text-sm text-n-slate-11 h-[50px] leading-[50px] relative text-center w-full before:content-[''] before:h-px before:absolute before:top-6 before:w-[calc((100%-120px)/2)] before:bg-n-slate-4 before:dark:bg-n-slate-6 before:left-0 after:content-[''] after:h-px after:absolute after:top-6 after:w-[calc((100%-120px)/2)] after:bg-n-slate-4 after:dark:bg-n-slate-6 after:right-0"};function Tn(e,n,s,u,i,t){return o(),r("div",vn,_(t.formattedDate),1)}const kn=p(Cn,[["render",Tn]]),Sn={name:"ConversationWrap",components:{ChatMessage:pn,AgentTypingBubble:yn,DateSeparator:kn,Spinner:B},props:{groupedMessages:{type:Array,default:()=>[]}},setup(){const{darkMode:e}=ve();return{darkMode:e}},data(){return{previousScrollHeight:0,previousConversationSize:0}},computed:{...T({earliestMessage:"conversation/getEarliestMessage",lastMessage:"conversation/getLastMessage",allMessagesLoaded:"conversation/getAllMessagesLoaded",isFetchingList:"conversation/getIsFetchingList",conversationSize:"conversation/getConversationSize",isAgentTyping:"conversation/getIsAgentTyping",conversationAttributes:"conversationAttributes/getConversationParams"}),colorSchemeClass(){return`${this.darkMode==="dark"?"dark-scheme":"light-scheme"}`},showStatusIndicator(){const{status:e}=this.conversationAttributes,n=e==="pending",s=this.lastMessage.message_type===le.INCOMING;return this.isAgentTyping||n&&s}},watch:{allMessagesLoaded(){this.previousScrollHeight=0}},mounted(){this.$el.addEventListener("scroll",this.handleScroll),this.scrollToBottom()},updated(){this.previousConversationSize!==this.conversationSize&&(this.previousConversationSize=this.conversationSize,this.scrollToBottom())},unmounted(){this.$el.removeEventListener("scroll",this.handleScroll)},methods:{...W("conversation",["fetchOldConversations"]),scrollToBottom(){const e=this.$el;e.scrollTop=e.scrollHeight-this.previousScrollHeight,this.previousScrollHeight=0},handleScroll(){this.isFetchingList||this.allMessagesLoaded||!this.conversationSize||this.$el.scrollTop<100&&(this.fetchOldConversations({before:this.earliestMessage.id}),this.previousScrollHeight=this.$el.scrollHeight)}}},En={key:0,class:"message--loader"};function An(e,n,s,u,i,t){const a=l("Spinner"),c=l("DateSeparator"),g=l("ChatMessage"),f=l("AgentTypingBubble");return o(),r("div",{class:v(["conversation--container",t.colorSchemeClass])},[d("div",{class:v(["conversation-wrap",{"is-typing":e.isAgentTyping}])},[e.isFetchingList?(o(),r("div",En,[b(a)])):m("",!0),(o(!0),r(E,null,A(s.groupedMessages,k=>(o(),r("div",{key:k.date,class:"messages-wrap"},[b(c,{date:k.date},null,8,["date"]),(o(!0),r(E,null,A(k.messages,R=>(o(),h(g,{key:R.id,message:R},null,8,["message"]))),128))]))),128)),t.showStatusIndicator?(o(),h(f,{key:1})):m("",!0)],2)],2)}const wn=p(Sn,[["render",An],["__scopeId","data-v-a6ec1f69"]]),In={components:{ChatFooter:Qe,ConversationWrap:wn},computed:{...T({groupedMessages:"conversation/getGroupedConversation"})},mounted(){this.$store.dispatch("conversation/setUserLastSeen")}},xn={class:"flex flex-col flex-1 overflow-hidden rounded-b-lg bg-n-slate-2 dark:bg-n-solid-1"},Rn={class:"flex flex-1 overflow-auto"};function Mn(e,n,s,u,i,t){const a=l("ConversationWrap"),c=l("ChatFooter");return o(),r("div",xn,[d("div",Rn,[b(a,{"grouped-messages":e.groupedMessages},null,8,["grouped-messages"])]),b(c,{class:"px-5"})])}const Jn=p(In,[["render",Mn]]);export{Jn as default};
//# sourceMappingURL=Messages-2pdgVYxs.js.map
