{"version":3,"file":"UnreadMessageList-DEo4cJiG.js","sources":["../../../app/javascript/widget/components/UnreadMessage.vue","../../../app/javascript/widget/components/UnreadMessageList.vue"],"sourcesContent":["<script>\nimport { useMessageFormatter } from 'shared/composables/useMessageFormatter';\nimport Avatar from 'dashboard/components-next/avatar/Avatar.vue';\nimport configMixin from '../mixins/configMixin';\nimport { isEmptyObject } from 'widget/helpers/utils';\nimport {\n  ON_CAMPAIGN_MESSAGE_CLICK,\n  ON_UNREAD_MESSAGE_CLICK,\n} from '../constants/widgetBusEvents';\nimport { emitter } from 'shared/helpers/mitt';\n\nexport default {\n  name: 'UnreadMessage',\n  components: { Avatar },\n  mixins: [configMixin],\n  props: {\n    message: {\n      type: String,\n      default: '',\n    },\n    showSender: {\n      type: Boolean,\n      default: false,\n    },\n    sender: {\n      type: Object,\n      default: () => {},\n    },\n    campaignId: {\n      type: Number,\n      default: null,\n    },\n  },\n  setup() {\n    const { formatMessage, getPlainText, truncateMessage, highlightContent } =\n      useMessageFormatter();\n    return {\n      formatMessage,\n      getPlainText,\n      truncateMessage,\n      highlightContent,\n    };\n  },\n  computed: {\n    companyName() {\n      return `${this.$t('UNREAD_VIEW.COMPANY_FROM')} ${\n        this.channelConfig.websiteName\n      }`;\n    },\n    avatarUrl() {\n      // eslint-disable-next-line\n      const displayImage = this.useInboxAvatarForBot\n        ? this.inboxAvatarUrl\n        : '/assets/images/chatwoot_bot.png';\n      if (this.isSenderExist(this.sender)) {\n        const { avatar_url: avatarUrl } = this.sender;\n        return avatarUrl;\n      }\n      return displayImage;\n    },\n    agentName() {\n      if (this.isSenderExist(this.sender)) {\n        const { available_name: availableName } = this.sender;\n        return availableName;\n      }\n      if (this.useInboxAvatarForBot) {\n        return this.channelConfig.websiteName;\n      }\n      return this.$t('UNREAD_VIEW.BOT');\n    },\n    availabilityStatus() {\n      if (this.isSenderExist(this.sender)) {\n        const { availability_status: availabilityStatus } = this.sender;\n        return availabilityStatus;\n      }\n      return null;\n    },\n  },\n  methods: {\n    isSenderExist(sender) {\n      return sender && !isEmptyObject(sender);\n    },\n    onClickMessage() {\n      if (this.campaignId) {\n        emitter.emit(ON_CAMPAIGN_MESSAGE_CLICK, this.campaignId);\n      } else {\n        emitter.emit(ON_UNREAD_MESSAGE_CLICK);\n      }\n    },\n  },\n};\n</script>\n\n<template>\n  <div class=\"chat-bubble-wrap\">\n    <button class=\"chat-bubble agent bg-white\" @click=\"onClickMessage\">\n      <div v-if=\"showSender\" class=\"row--agent-block\">\n        <Avatar\n          :src=\"avatarUrl\"\n          :size=\"20\"\n          :name=\"agentName\"\n          :status=\"availabilityStatus\"\n          rounded-full\n        />\n        <span v-dompurify-html=\"agentName\" class=\"agent--name\" />\n        <span v-dompurify-html=\"companyName\" class=\"company--name\" />\n      </div>\n      <div\n        v-dompurify-html=\"formatMessage(message, false)\"\n        class=\"message-content\"\n      />\n    </button>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.chat-bubble {\n  @apply max-w-[85%] cursor-pointer p-4;\n}\n\n.row--agent-block {\n  @apply items-center flex text-left pb-2 text-xs;\n\n  .agent--name {\n    @apply font-medium ml-1;\n  }\n\n  .company--name {\n    @apply text-n-slate-11 dark:text-n-slate-10 ml-1;\n  }\n}\n</style>\n","<script>\nimport { mapGetters } from 'vuex';\nimport configMixin from '../mixins/configMixin';\nimport { ON_UNREAD_MESSAGE_CLICK } from '../constants/widgetBusEvents';\nimport FluentIcon from 'shared/components/FluentIcon/Index.vue';\nimport UnreadMessage from 'widget/components/UnreadMessage.vue';\nimport { isWidgetColorLighter } from 'shared/helpers/colorHelper';\nimport { emitter } from 'shared/helpers/mitt';\n\nexport default {\n  name: 'Unread',\n  components: {\n    FluentIcon,\n    UnreadMessage,\n  },\n  mixins: [configMixin],\n  props: {\n    messages: {\n      type: Array,\n      required: true,\n    },\n  },\n  emits: ['close'],\n  computed: {\n    ...mapGetters({\n      unreadMessageCount: 'conversation/getUnreadMessageCount',\n      widgetColor: 'appConfig/getWidgetColor',\n    }),\n    sender() {\n      const [firstMessage] = this.messages;\n      return firstMessage.sender || {};\n    },\n    isBackgroundLighter() {\n      return isWidgetColorLighter(this.widgetColor);\n    },\n  },\n  methods: {\n    openConversationView() {\n      emitter.emit(ON_UNREAD_MESSAGE_CLICK);\n    },\n    closeFullView() {\n      this.$emit('close');\n    },\n    getMessageContent(message) {\n      const { attachments, content } = message;\n      const hasAttachments = attachments && attachments.length;\n\n      if (content) return content;\n\n      if (hasAttachments) return `ðŸ“‘`;\n\n      return '';\n    },\n  },\n};\n</script>\n\n<template>\n  <div class=\"unread-wrap\" dir=\"ltr\">\n    <div class=\"close-unread-wrap\">\n      <button class=\"button small close-unread-button\" @click=\"closeFullView\">\n        <span class=\"flex items-center\">\n          <FluentIcon class=\"mr-1\" icon=\"dismiss\" size=\"12\" />\n          {{ $t('UNREAD_VIEW.CLOSE_MESSAGES_BUTTON') }}\n        </span>\n      </button>\n    </div>\n    <div class=\"unread-messages\">\n      <UnreadMessage\n        v-for=\"(message, index) in messages\"\n        :key=\"message.id\"\n        :message-type=\"message.messageType\"\n        :message-id=\"message.id\"\n        :show-sender=\"!index\"\n        :sender=\"message.sender\"\n        :message=\"getMessageContent(message)\"\n        :campaign-id=\"message.campaignId\"\n      />\n    </div>\n\n    <div class=\"open-read-view-wrap\">\n      <button\n        v-if=\"unreadMessageCount\"\n        class=\"button clear-button\"\n        @click=\"openConversationView\"\n      >\n        <span\n          class=\"flex items-center\"\n          :class=\"{\n            '!text-n-slate-12': isBackgroundLighter,\n          }\"\n          :style=\"{\n            color: widgetColor,\n          }\"\n        >\n          <FluentIcon class=\"mr-2\" size=\"16\" icon=\"arrow-right\" />\n          {{ $t('UNREAD_VIEW.VIEW_MESSAGES_BUTTON') }}\n        </span>\n      </button>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n.unread-wrap {\n  width: 100%;\n  height: auto;\n  max-height: 100vh;\n  background: transparent;\n  display: flex;\n  flex-direction: column;\n  flex-wrap: nowrap;\n  justify-content: flex-end;\n  overflow: hidden;\n\n  .unread-messages {\n    @apply pb-2;\n  }\n\n  .clear-button {\n    transition: all 0.3s cubic-bezier(0.17, 0.67, 0.83, 0.67);\n    @apply bg-transparent text-n-brand border-none border-0 font-semibold text-base ml-1 py-0 pl-0 pr-2.5 hover:brightness-75 hover:translate-x-1;\n  }\n\n  .close-unread-button {\n    transition: all 0.3s cubic-bezier(0.17, 0.67, 0.83, 0.67);\n    @apply bg-n-slate-3 dark:bg-n-slate-12 text-n-slate-12 dark:text-n-slate-1 hover:brightness-95 border-none border-0 font-medium text-xxs rounded-2xl mb-3;\n  }\n}\n</style>\n"],"names":["_sfc_main","Avatar","configMixin","formatMessage","getPlainText","truncateMessage","highlightContent","useMessageFormatter","displayImage","avatarUrl","availableName","availabilityStatus","sender","isEmptyObject","emitter","ON_CAMPAIGN_MESSAGE_CLICK","ON_UNREAD_MESSAGE_CLICK","_hoisted_1","_hoisted_3","_hoisted_4","_hoisted_5","_openBlock","_createElementBlock","_createElementVNode","$options","args","$props","_hoisted_2","_createVNode","_component_Avatar","_withDirectives","_createCommentVNode","_directive_dompurify_html","$setup","FluentIcon","UnreadMessage","mapGetters","firstMessage","isWidgetColorLighter","message","attachments","content","hasAttachments","_component_FluentIcon","_createTextVNode","_ctx","_Fragment","_renderList","index","_createBlock","_component_UnreadMessage","_normalizeClass","_normalizeStyle"],"mappings":"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"}