{"version":3,"file":"PortalsArticlesEditPage-Da8uXtQQ.js","sources":["../../../app/javascript/dashboard/routes/dashboard/helpcenter/pages/PortalsArticlesEditPage.vue"],"sourcesContent":["<script setup>\nimport { ref, computed, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { useI18n } from 'vue-i18n';\nimport { useAlert, useTrack } from 'dashboard/composables';\nimport { PORTALS_EVENTS } from 'dashboard/helper/AnalyticsHelper/events';\nimport { buildPortalArticleURL } from 'dashboard/helper/portalHelper';\nimport { useStore, useMapGetter } from 'dashboard/composables/store';\n\nimport ArticleEditor from 'dashboard/components-next/HelpCenter/Pages/ArticleEditorPage/ArticleEditor.vue';\n\nconst route = useRoute();\nconst router = useRouter();\nconst store = useStore();\nconst { t } = useI18n();\n\nconst { articleSlug, portalSlug } = route.params;\n\nconst articleById = useMapGetter('articles/articleById');\n\nconst article = computed(() => articleById.value(articleSlug));\n\nconst portalBySlug = useMapGetter('portals/portalBySlug');\n\nconst portal = computed(() => portalBySlug.value(portalSlug));\n\nconst isUpdating = ref(false);\nconst isSaved = ref(false);\n\nconst articleLink = computed(() => {\n  const { slug: categorySlug, locale: categoryLocale } = article.value.category;\n  const { slug: articleSlugValue } = article.value;\n  const portalCustomDomain = portal.value?.custom_domain;\n  return buildPortalArticleURL(\n    portalSlug,\n    categorySlug,\n    categoryLocale,\n    articleSlugValue,\n    portalCustomDomain\n  );\n});\n\nconst saveArticle = async ({ ...values }, isAsync = false) => {\n  const actionToDispatch = isAsync ? 'articles/updateAsync' : 'articles/update';\n  isUpdating.value = true;\n  try {\n    await store.dispatch(actionToDispatch, {\n      portalSlug,\n      articleId: articleSlug,\n      ...values,\n    });\n    isSaved.value = true;\n  } catch (error) {\n    const errorMessage =\n      error?.message || t('HELP_CENTER.EDIT_ARTICLE_PAGE.API.ERROR');\n    useAlert(errorMessage);\n  } finally {\n    setTimeout(() => {\n      isUpdating.value = false;\n      isSaved.value = true;\n    }, 1500);\n  }\n};\n\nconst saveArticleAsync = async ({ ...values }) => {\n  saveArticle({ ...values }, true);\n};\n\nconst isCategoryArticles = computed(() => {\n  return (\n    route.name === 'portals_categories_articles_index' ||\n    route.name === 'portals_categories_articles_edit' ||\n    route.name === 'portals_categories_index'\n  );\n});\n\nconst goBackToArticles = () => {\n  const { tab, categorySlug, locale } = route.params;\n  if (isCategoryArticles.value) {\n    router.push({\n      name: 'portals_categories_articles_index',\n      params: { categorySlug, locale },\n    });\n  } else {\n    router.push({\n      name: 'portals_articles_index',\n      params: { tab, categorySlug, locale },\n    });\n  }\n};\n\nconst fetchArticleDetails = () => {\n  store.dispatch('articles/show', {\n    id: articleSlug,\n    portalSlug,\n  });\n};\n\nconst previewArticle = () => {\n  window.open(articleLink.value, '_blank');\n  useTrack(PORTALS_EVENTS.PREVIEW_ARTICLE, {\n    status: article.value?.status,\n  });\n};\n\nonMounted(fetchArticleDetails);\n</script>\n\n<template>\n  <ArticleEditor\n    :article=\"article\"\n    :is-updating=\"isUpdating\"\n    :is-saved=\"isSaved\"\n    @save-article=\"saveArticle\"\n    @save-article-async=\"saveArticleAsync\"\n    @preview-article=\"previewArticle\"\n    @go-back=\"goBackToArticles\"\n  />\n</template>\n"],"names":["route","useRoute","router","useRouter","store","useStore","t","useI18n","articleSlug","portalSlug","articleById","useMapGetter","article","computed","portalBySlug","portal","isUpdating","ref","isSaved","articleLink","categorySlug","categoryLocale","articleSlugValue","portalCustomDomain","_a","buildPortalArticleURL","saveArticle","values","isAsync","actionToDispatch","error","errorMessage","useAlert","saveArticleAsync","isCategoryArticles","goBackToArticles","tab","locale","fetchArticleDetails","previewArticle","useTrack","PORTALS_EVENTS","onMounted"],"mappings":"s8BAWA,MAAMA,EAAQC,EAAQ,EAChBC,EAASC,EAAS,EAClBC,EAAQC,EAAQ,EAChB,CAAE,EAAAC,CAAC,EAAKC,EAAO,EAEf,CAAE,YAAAC,EAAa,WAAAC,GAAeT,EAAM,OAEpCU,EAAcC,EAAa,sBAAsB,EAEjDC,EAAUC,EAAS,IAAMH,EAAY,MAAMF,CAAW,CAAC,EAEvDM,EAAeH,EAAa,sBAAsB,EAElDI,EAASF,EAAS,IAAMC,EAAa,MAAML,CAAU,CAAC,EAEtDO,EAAaC,EAAI,EAAK,EACtBC,EAAUD,EAAI,EAAK,EAEnBE,EAAcN,EAAS,IAAM,OACjC,KAAM,CAAE,KAAMO,EAAc,OAAQC,GAAmBT,EAAQ,MAAM,SAC/D,CAAE,KAAMU,CAAgB,EAAKV,EAAQ,MACrCW,GAAqBC,EAAAT,EAAO,QAAP,YAAAS,EAAc,cACzC,OAAOC,EACLhB,EACAW,EACAC,EACAC,EACAC,CACJ,CACA,CAAC,EAEKG,EAAc,MAAO,CAAE,GAAGC,CAAM,EAAIC,EAAU,KAAU,CAC5D,MAAMC,EAAmBD,EAAU,uBAAyB,kBAC5DZ,EAAW,MAAQ,GACnB,GAAI,CACF,MAAMZ,EAAM,SAASyB,EAAkB,CACrC,WAAApB,EACA,UAAWD,EACX,GAAGmB,CACT,CAAK,EACDT,EAAQ,MAAQ,EAClB,OAASY,EAAO,CACd,MAAMC,GACJD,GAAA,YAAAA,EAAO,UAAWxB,EAAE,yCAAyC,EAC/D0B,EAASD,CAAY,CACvB,QAAC,CACC,WAAW,IAAM,CACff,EAAW,MAAQ,GACnBE,EAAQ,MAAQ,EAClB,EAAG,IAAI,CACT,CACF,EAEMe,EAAmB,MAAO,CAAE,GAAGN,KAAa,CAChDD,EAAY,CAAE,GAAGC,CAAM,EAAI,EAAI,CACjC,EAEMO,EAAqBrB,EAAS,IAEhCb,EAAM,OAAS,qCACfA,EAAM,OAAS,oCACfA,EAAM,OAAS,0BAElB,EAEKmC,EAAmB,IAAM,CAC7B,KAAM,CAAE,IAAAC,EAAK,aAAAhB,EAAc,OAAAiB,CAAM,EAAKrC,EAAM,OACxCkC,EAAmB,MACrBhC,EAAO,KAAK,CACV,KAAM,oCACN,OAAQ,CAAE,aAAAkB,EAAc,OAAAiB,CAAM,CACpC,CAAK,EAEDnC,EAAO,KAAK,CACV,KAAM,yBACN,OAAQ,CAAE,IAAAkC,EAAK,aAAAhB,EAAc,OAAAiB,CAAM,CACzC,CAAK,CAEL,EAEMC,EAAsB,IAAM,CAChClC,EAAM,SAAS,gBAAiB,CAC9B,GAAII,EACJ,WAAAC,CACJ,CAAG,CACH,EAEM8B,EAAiB,IAAM,OAC3B,OAAO,KAAKpB,EAAY,MAAO,QAAQ,EACvCqB,EAASC,EAAe,gBAAiB,CACvC,QAAQjB,EAAAZ,EAAQ,QAAR,YAAAY,EAAe,MAC3B,CAAG,CACH,EAEA,OAAAkB,EAAUJ,CAAmB"}