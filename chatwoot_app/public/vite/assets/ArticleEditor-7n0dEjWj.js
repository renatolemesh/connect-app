import{_ as ae,n as H,o as L,p as E,r as x,c as I,e as g,H as f,g as k,t as N,l as b,a as V,f as de,Y as pe,w as Ee,L as le}from"./_plugin-vue_export-helper-DG4P_01H.js";import{d as F}from"./utils.esm-CMazHLgs.js";import{u as z,b as me,c as W}from"./useBranding-78t2cBKJ.js";import{k as fe,u as ge,h as he,i as ve,j as X,c as Z,g as Ae,m as oe,n as Ie,o as _e,p as Te}from"./dashboard-n_HDIbaW.js";import{_ as Re}from"./HelpCenterLayout-kAjKzASB.js";import{P as Ce,S as Se,p as Le,s as Pe,L as ye,E as be,n as we,N as xe,O as J}from"./typing-DAnjQ7Xa.js";import{u as B,a as Q}from"./index-CQCyHBIl.js";import{u as ie,w as $e}from"./Validators-BM89Tp7H.js";import{at as G,aA as ee}from"./DashboardIcon-32bIzNqT.js";import{_ as w}from"./index-Cw6s38ZS.js";import{_ as Ue}from"./index-BfMIn2Vn.js";function De(t,o,i){i.state.doc.descendants((a,r)=>{if(a.type.name==="image"&&a.attrs.src===t){const c=i.state.tr.setNodeMarkup(r,null,{...a.attrs,src:o});i.dispatch(c)}})}const Oe=t=>new Ce({props:{handlePaste(o,i,a){const r=[];a.content.descendants(c=>{c.type.name==="image"&&r.push(c.attrs.src)}),Promise.all(r.map(async c=>{try{const n=await t(c);De(c,n,o)}catch(n){console.error("Error uploading image:",n)}}))}}}),te=4,se=(t,o,i=[],a={},r)=>be.create({doc:new xe(J).parse(t),plugins:we({schema:J,placeholder:o,methods:a,plugins:i,enabledMenuOptions:r})});let A=null,y;const ke={mixins:[fe],props:{modelValue:{type:String,default:""},editorId:{type:String,default:""},placeholder:{type:String,default:""},enabledMenuOptions:{type:Array,default:()=>[]},autofocus:{type:Boolean,default:!0}},emits:["blur","input","update:modelValue","keyup","focus","keydown"],setup(){const{uiSettings:t,updateUISettings:o}=ge();return{uiSettings:t,updateUISettings:o}},data(){return{plugins:[Oe(this.handleImageUpload)],isTextSelected:!1}},watch:{modelValue(t=""){t!==this.contentFromEditor()&&this.reloadState()},editorId(){this.reloadState()}},created(){y=se(this.modelValue,this.placeholder,this.plugins,{onImageUpload:this.openFileBrowser},this.enabledMenuOptions)},mounted(){this.createEditorView(),A.updateState(y),this.autofocus&&this.focusEditorInputField()},methods:{contentFromEditor(){return A?ye.serialize(A.state.doc):""},openFileBrowser(){this.$refs.imageUploadInput.click()},async handleImageUpload(t){try{return await this.$store.dispatch("articles/uploadExternalImage",{portalSlug:this.$route.params.portalSlug,url:t})}catch{return B(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.UN_AUTHORIZED_ERROR")),""}},onFileChange(){const t=this.$refs.imageUploadInput.files[0];Pe(t,te)?this.uploadImageToStorage(t):B(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR_FILE_SIZE",{size:te})),this.$refs.imageUploadInput.value=""},async uploadImageToStorage(t){try{const o=await this.$store.dispatch("articles/attachImage",{portalSlug:this.$route.params.portalSlug,file:t});o&&this.onImageUploadStart(o)}catch{B(this.$t("HELP_CENTER.ARTICLE_EDITOR.IMAGE_UPLOAD.ERROR"))}},onImageUploadStart(t){const{selection:o}=A.state,i=o.from,a=A.state.schema.nodes.image.create({src:t}),r=A.state.schema.node("paragraph");if(a){const c=A.state.tr.replaceSelectionWith(r).insert(i+1,a);A.dispatch(c.scrollIntoView()),this.focusEditorInputField()}},reloadState(){y=se(this.modelValue,this.placeholder,this.plugins,{onImageUpload:this.openFileBrowser},this.enabledMenuOptions),A.updateState(y),this.focusEditorInputField()},createEditorView(){A=new Le(this.$refs.editor,{state:y,dispatchTransaction:t=>{y=y.apply(t),A.updateState(y),t.docChanged&&this.emitOnChange(),this.checkSelection(y)},handleDOMEvents:{keyup:this.onKeyup,focus:this.onFocus,blur:this.onBlur,keydown:this.onKeydown,paste:(t,o)=>{const i=o.clipboardData.files;i.length>0&&(i.forEach(a=>{a.type.includes("image")&&this.uploadImageToStorage(a)}),o.preventDefault())}}})},handleKeyEvents(){},focusEditorInputField(){const{tr:t}=A.state,o=Se.atEnd(t.doc);A.dispatch(t.setSelection(o)),A.focus()},emitOnChange(){this.$emit("update:modelValue",this.contentFromEditor()),this.$emit("input",this.contentFromEditor())},onKeyup(){this.$emit("keyup")},onKeydown(){this.$emit("keydown")},onBlur(){this.$emit("blur")},onFocus(){this.$emit("focus")},checkSelection(t){const{from:o,to:i}=t.selection,a=o!==i;if(a===this.isTextSelected)return;this.isTextSelected=a;const{editor:r}=this.$refs;r.classList.toggle("has-selection",a),a&&this.setMenubarPosition(t)},setMenubarPosition(t){if(!t.selection)return;const{from:o,to:i}=t.selection,{editor:a}=this.$refs,{left:r,top:c}=a.getBoundingClientRect(),n=a.offsetWidth,v=480,{bottom:d,right:p}=A.coordsAtPos(i),{left:m}=A.coordsAtPos(o),S=d-c+10,R=Math.max(0,Math.min((m+p)/2-r,n-v));a.style.setProperty("--selection-top",`${S}px`),a.style.setProperty("--selection-left",`${R}px`)}}},Ne={class:"editor-root editor--article"},He={ref:"editor"};function Me(t,o,i,a,r,c){return L(),H("div",null,[E("div",Ne,[E("input",{ref:"imageUploadInput",type:"file",accept:"image/png, image/jpeg, image/jpg, image/gif, image/webp",hidden:"",onChange:o[0]||(o[0]=(...n)=>c.onFileChange&&c.onFileChange(...n))},null,544),E("div",He,null,512)])])}const Ve=ae(ke,[["render",Me]]),Be={class:"flex items-center justify-between h-20"},Fe={class:"flex items-center gap-4"},Ge={key:0,class:"text-xs font-medium transition-all duration-300 text-n-slate-11"},ze={class:"flex items-center gap-2"},je={class:"flex items-center"},Ke={class:"relative"},We={__name:"ArticleEditorHeader",props:{isUpdating:{type:Boolean,default:!1},isSaved:{type:Boolean,default:!1},status:{type:String,default:""},articleId:{type:Number,default:0}},emits:["goBack","previewArticle"],setup(t,{emit:o}){const i=t,a=o,{t:r}=z(),c=me(),n=ie(),v=x(!1),{ARTICLE_STATUS_TYPES:d}=$e,p=x(!1),m=I(()=>(he[i.status]??[]).map(l=>{const{label:h,value:_,icon:j}=ve[l];return{label:r(h),value:_,action:"update-status",icon:j}})),S=I(()=>r(`HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.STATUS.${i.isUpdating?"SAVING":"SAVED"}`)),R=()=>a("goBack"),$=()=>a("previewArticle"),C=(T,l)=>{const h=l?"SUCCESS":"ERROR",_={[d.PUBLISH]:"PUBLISH_ARTICLE",[d.ARCHIVE]:"ARCHIVE_ARTICLE",[d.DRAFT]:"DRAFT_ARTICLE"};return _[T]?r(`HELP_CENTER.${_[T]}.API.${h}`):""},U=async({value:T})=>{p.value=!1;const l=Ae(T);l===d.PUBLISH&&(v.value=!0);const{portalSlug:h}=n.params;try{await c.dispatch("articles/update",{portalSlug:h,articleId:i.articleId,status:l}),B(C(l,!0)),l===d.ARCHIVE?Q(ee.ARCHIVE_ARTICLE,{uiFrom:"header"}):l===d.PUBLISH&&Q(ee.PUBLISH_ARTICLE),v.value=!1}catch(_){B((_==null?void 0:_.message)??C(l,!1)),v.value=!1}};return(T,l)=>(L(),H("div",Be,[g(w,{label:f(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.BACK_TO_ARTICLES"),icon:"i-lucide-chevron-left",variant:"link",color:"slate",size:"sm",class:"ltr:pl-3 rtl:pr-3",onClick:R},null,8,["label"]),E("div",Fe,[t.isUpdating||t.isSaved?(L(),H("span",Ge,N(S.value),1)):k("",!0),E("div",ze,[g(w,{label:f(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.PREVIEW"),color:"slate",size:"sm",disabled:!t.articleId,onClick:$},null,8,["label","disabled"]),E("div",je,[g(w,{label:f(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.HEADER.PUBLISH"),size:"sm",class:"ltr:rounded-r-none rtl:rounded-l-none","is-loading":v.value,disabled:t.status===f(X).PUBLISHED||!t.articleId||v.value,onClick:l[0]||(l[0]=h=>U({value:f(X).PUBLISHED}))},null,8,["label","is-loading","disabled"]),E("div",Ke,[g(f(G),{onTrigger:l[3]||(l[3]=h=>p.value=!1)},{default:b(()=>[g(w,{icon:"i-lucide-chevron-down",size:"sm",disabled:!t.articleId,class:"ltr:rounded-l-none rtl:rounded-r-none",onClick:l[1]||(l[1]=de(h=>p.value=!p.value,["stop"]))},null,8,["disabled"]),p.value?(L(),V(Z,{key:0,"menu-items":m.value,class:"mt-2 ltr:right-0 rtl:left-0 top-full",onAction:l[2]||(l[2]=h=>U(h))},null,8,["menu-items"])):k("",!0)]),_:1})])])])])]))}},Ze={class:"flex flex-col absolute w-[25rem] bg-n-alpha-3 outline outline-1 outline-n-container backdrop-blur-[100px] shadow-lg gap-6 rounded-xl p-6"},qe={class:"flex items-center justify-between"},Ye={class:"flex flex-col gap-2"},Xe={class:"flex justify-between w-full gap-4 py-2"},Je={class:"text-sm font-medium whitespace-nowrap min-w-[6.25rem] text-n-slate-12"},Qe={class:"flex justify-between w-full gap-2 py-2"},et={class:"flex justify-between w-full gap-3 py-2"},tt={class:"text-sm font-medium whitespace-nowrap min-w-[7.5rem] text-n-slate-12"},st={__name:"ArticleEditorProperties",props:{article:{type:Object,required:!0}},emits:["saveArticle","close"],setup(t,{emit:o}){const i=t,a=o,r=F(d=>a("saveArticle",d),400,!1),{t:c}=z(),n=pe({title:"",description:"",tags:[]}),v=()=>{var d,p,m;n.title=((d=i.article.meta)==null?void 0:d.title)||"",n.description=((p=i.article.meta)==null?void 0:p.description)||"",n.tags=((m=i.article.meta)==null?void 0:m.tags)||[]};return Ee(n,d=>{r({title:d.title,description:d.description,tags:d.tags})},{deep:!0}),le(()=>{v()}),(d,p)=>(L(),H("div",Ze,[E("div",qe,[E("h3",null,N(f(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.ARTICLE_PROPERTIES")),1),g(w,{icon:"i-lucide-x",size:"sm",variant:"ghost",color:"slate",class:"hover:text-n-slate-11",onClick:p[0]||(p[0]=m=>a("close"))})]),E("div",Ye,[E("div",null,[E("div",Xe,[E("label",Je,N(f(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_DESCRIPTION")),1),g(oe,{modelValue:n.description,"onUpdate:modelValue":p[1]||(p[1]=m=>n.description=m),placeholder:f(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_DESCRIPTION_PLACEHOLDER"),class:"w-[13.75rem]","custom-text-area-wrapper-class":"!p-0 !border-0 !rounded-none !bg-transparent transition-none","custom-text-area-class":"max-h-[9.375rem]","auto-height":"","min-height":"3rem"},null,8,["modelValue","placeholder"])]),E("div",Qe,[g(Ie,{modelValue:n.title,"onUpdate:modelValue":p[2]||(p[2]=m=>n.title=m),placeholder:f(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TITLE_PLACEHOLDER"),label:f(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TITLE"),"custom-label-class":"min-w-[7.5rem]"},null,8,["modelValue","placeholder","label"])]),E("div",et,[E("label",tt,N(f(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TAGS")),1),g(_e,{modelValue:n.tags,"onUpdate:modelValue":p[3]||(p[3]=m=>n.tags=m),placeholder:f(c)("HELP_CENTER.EDIT_ARTICLE_PAGE.ARTICLE_PROPERTIES.META_TAGS_PLACEHOLDER"),class:"w-[14rem]"},null,8,["modelValue","placeholder"])])])])]))}},at={class:"flex items-center gap-4"},lt={class:"relative flex items-center gap-2"},ot={class:"text-sm text-n-slate-12 hover:text-n-slate-11"},it={class:"relative"},nt={key:0,class:"text-sm text-n-slate-12 hover:text-n-slate-11"},rt={class:"relative"},ct={__name:"ArticleEditorControls",props:{article:{type:Object,default:()=>({})}},emits:["saveArticle","setAuthor","setCategory"],setup(t,{emit:o}){const i=t,a=o,{t:r}=z(),c=ie(),n=x(!1),v=x(!1),d=x(!1),p=x(null),m=x(null),S=W("agents/getAgents"),R=W("categories/allCategories"),$=W("getCurrentUserID"),C=I(()=>{var s;return!((s=i.article)!=null&&s.id)}),U=I(()=>S.value.find(s=>s.id===$.value)),T=I(()=>c.params.categorySlug),l=I(()=>{var s;return C.value?p.value?S.value.find(e=>e.id===p.value):U.value:((s=i.article)==null?void 0:s.author)||null}),h=I(()=>{var s,e;return((s=l.value)==null?void 0:s.name)||((e=l.value)==null?void 0:e.available_name)||""}),_=I(()=>{var s;return(s=l.value)==null?void 0:s.thumbnail}),j=I(()=>{var s;return((s=S.value)==null?void 0:s.map(({name:e,id:u,thumbnail:P})=>{var O,M;return{label:e,value:u,thumbnail:{name:e,src:P},isSelected:(M=(O=i.article)==null?void 0:O.author)!=null&&M.id?u===i.article.author.id:u===(p.value||$.value),action:"assignAuthor"}}).toSorted((e,u)=>e.isSelected!==u.isSelected?Number(u.isSelected)-Number(e.isSelected):e.label.localeCompare(u.label)))??[]}),ne=I(()=>{var s;return((s=S.value)==null?void 0:s.length)>1}),q=s=>{var e;return(e=R.value)==null?void 0:e.find(u=>u.slug===s)},re=s=>{const e=q(s);return e?(m.value=e.id,e):null},D=I(()=>{if(C.value){if(T.value){const s=re(T.value);if(s)return s}return m.value?R.value.find(s=>s.id===m.value):R.value[0]||null}return R.value.find(s=>{var e,u;return s.id===((u=(e=i.article)==null?void 0:e.category)==null?void 0:u.id)})}),Y=I(()=>R.value.map(({name:s,id:e,icon:u})=>{var P,O,M;return{label:s,value:e,emoji:u,isSelected:C.value?e===(m.value||((P=D.value)==null?void 0:P.id)):e===((M=(O=i.article)==null?void 0:O.category)==null?void 0:M.id),action:"assignCategory"}}).toSorted((s,e)=>Number(e.isSelected)-Number(s.isSelected))),ce=I(()=>{var s;return((s=Y.value)==null?void 0:s.length)>0}),K=({action:s,value:e})=>{var P;const u={assignAuthor:()=>{C.value?(p.value=e,a("setAuthor",e)):a("saveArticle",{author_id:e}),n.value=!1},assignCategory:()=>{C.value?(m.value=e,a("setCategory",e)):a("saveArticle",{category_id:e}),v.value=!1}};(P=u[s])==null||P.call(u)},ue=s=>{a("saveArticle",{meta:s})};return le(()=>{if(T.value&&C.value){const s=q(T.value);s&&K({action:"assignCategory",value:s==null?void 0:s.id})}}),(s,e)=>(L(),H("div",at,[E("div",lt,[g(f(G),{onTrigger:e[1]||(e[1]=u=>n.value=!1)},{default:b(()=>[g(w,{variant:"ghost",color:"slate",class:"!px-0 font-normal hover:!bg-transparent","text-variant":"info",onClick:e[0]||(e[0]=u=>n.value=!n.value)},{default:b(()=>[g(Ue,{name:h.value,src:_.value,size:20,"rounded-full":""},null,8,["name","src"]),E("span",ot,N(h.value||"-"),1)]),_:1}),n.value&&ne.value?(L(),V(Z,{key:0,"menu-items":j.value,"show-search":"",class:"z-[100] w-48 mt-2 overflow-y-auto ltr:left-0 rtl:right-0 top-full max-h-60",onAction:K},null,8,["menu-items"])):k("",!0)]),_:1})]),e[7]||(e[7]=E("div",{class:"w-px h-3 bg-n-weak"},null,-1)),E("div",it,[g(f(G),{onTrigger:e[3]||(e[3]=u=>v.value=!1)},{default:b(()=>{var u,P;return[g(w,{label:((u=D.value)==null?void 0:u.name)||f(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.UNCATEGORIZED"),icon:(P=D.value)!=null&&P.icon?"":"i-lucide-shapes",variant:"ghost",color:"slate",class:"!px-2 font-normal hover:!bg-transparent",onClick:e[2]||(e[2]=O=>v.value=!v.value)},{default:b(()=>[D.value?(L(),H("span",nt,N(`${D.value.icon||""} ${D.value.name||f(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.UNCATEGORIZED")}`),1)):k("",!0)]),_:1},8,["label","icon"]),v.value&&ce.value?(L(),V(Z,{key:0,"menu-items":Y.value,"show-search":"",class:"w-48 mt-2 z-[100] overflow-y-auto left-0 top-full max-h-60",onAction:K},null,8,["menu-items"])):k("",!0)]}),_:1})]),e[8]||(e[8]=E("div",{class:"w-px h-3 bg-n-weak"},null,-1)),E("div",rt,[g(f(G),{onTrigger:e[6]||(e[6]=u=>d.value=!1)},{default:b(()=>[g(w,{label:f(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.MORE_PROPERTIES"),icon:"i-lucide-plus",variant:"ghost",color:"slate",disabled:C.value,class:"!px-2 font-normal hover:!bg-transparent hover:!text-n-slate-11",onClick:e[4]||(e[4]=u=>d.value=!d.value)},null,8,["label","disabled"]),d.value?(L(),V(st,{key:0,article:t.article,class:"right-0 z-[100] mt-2 xl:left-0 top-full",onSaveArticle:ue,onClose:e[5]||(e[5]=u=>d.value=!1)},null,8,["article"])):k("",!0)]),_:1})])]))}},ut={class:"flex flex-col gap-3 pl-4 mb-3 rtl:pr-3 rtl:pl-0"},dt={__name:"ArticleEditor",props:{article:{type:Object,default:()=>({})},isUpdating:{type:Boolean,default:!1},isSaved:{type:Boolean,default:!1}},emits:["saveArticle","saveArticleAsync","goBack","setAuthor","setCategory","previewArticle"],setup(t,{emit:o}){const i=t,a=o,{t:r}=z(),c=I(()=>{var l;return!((l=i.article)!=null&&l.id)}),n=l=>{a("saveArticle",l)},v=F(l=>a("saveArticleAsync",l),400,!1),d=F(n,2500,!1),p=F(n,400,!1),m=l=>{c.value?p(l):(v(l),d(l))},S=I({get:()=>i.article.title,set:l=>{m({title:l})}}),R=I({get:()=>i.article.content,set:l=>{m({content:l})}}),$=()=>{a("goBack")},C=l=>{a("setAuthor",l)},U=l=>{a("setCategory",l)},T=()=>{a("previewArticle")};return(l,h)=>(L(),V(Re,{"show-header-title":!1,"show-pagination-footer":!1},{"header-actions":b(()=>[g(We,{"is-updating":t.isUpdating,"is-saved":t.isSaved,status:t.article.status,"article-id":t.article.id,onGoBack:$,onPreviewArticle:T},null,8,["is-updating","is-saved","status","article-id"])]),content:b(()=>[E("div",ut,[g(oe,{modelValue:S.value,"onUpdate:modelValue":h[0]||(h[0]=_=>S.value=_),"auto-height":"","min-height":"4rem","custom-text-area-class":"!text-[32px] !leading-[48px] !font-medium !tracking-[0.2px]","custom-text-area-wrapper-class":"border-0 !bg-transparent dark:!bg-transparent !py-0 !px-0",placeholder:"Title",autofocus:""},null,8,["modelValue"]),g(ct,{article:t.article,onSaveArticle:n,onSetAuthor:C,onSetCategory:U},null,8,["article"])]),g(Ve,{modelValue:R.value,"onUpdate:modelValue":h[1]||(h[1]=_=>R.value=_),class:"py-0 pb-10 pl-4 rtl:pr-4 rtl:pl-0 h-fit",placeholder:f(r)("HELP_CENTER.EDIT_ARTICLE_PAGE.EDIT_ARTICLE.EDITOR_PLACEHOLDER"),"enabled-menu-options":f(Te),autofocus:!1},null,8,["modelValue","placeholder","enabled-menu-options"])]),_:1}))}},Rt=ae(dt,[["__scopeId","data-v-8d205a02"]]);export{Rt as A};
//# sourceMappingURL=ArticleEditor-7n0dEjWj.js.map
