{"version":3,"file":"Home-Df4kXN3u.js","sources":["../../../app/javascript/widget/components/TeamAvailability.vue","../../../app/javascript/widget/components/pageComponents/Home/Article/ArticleListItem.vue","../../../app/javascript/widget/components/pageComponents/Home/Article/ArticleBlock.vue","../../../app/javascript/widget/components/pageComponents/Home/Article/SkeletonLoader.vue","../../../app/javascript/shared/helpers/portalHelper.js","../../../app/javascript/widget/components/pageComponents/Home/Article/ArticleContainer.vue","../../../app/javascript/widget/views/Home.vue"],"sourcesContent":["<script setup>\nimport { IFrameHelper } from 'widget/helpers/utils';\nimport { CHATWOOT_ON_START_CONVERSATION } from '../constants/sdkEvents';\nimport AvailabilityContainer from 'widget/components/Availability/AvailabilityContainer.vue';\nimport { useMapGetter } from 'dashboard/composables/store.js';\n\nconst props = defineProps({\n  availableAgents: { type: Array, default: () => [] },\n  hasConversation: { type: Boolean, default: false },\n});\n\nconst emit = defineEmits(['startConversation']);\n\nconst widgetColor = useMapGetter('appConfig/getWidgetColor');\n\nconst startConversation = () => {\n  emit('startConversation');\n  if (!props.hasConversation) {\n    IFrameHelper.sendMessage({\n      event: 'onEvent',\n      eventIdentifier: CHATWOOT_ON_START_CONVERSATION,\n      data: { hasConversation: false },\n    });\n  }\n};\n</script>\n\n<template>\n  <div\n    class=\"flex flex-col gap-3 w-full shadow outline-1 outline outline-n-container rounded-xl bg-n-background dark:bg-n-solid-2 px-5 py-4\"\n  >\n    <AvailabilityContainer :agents=\"availableAgents\" show-header show-avatars />\n\n    <button\n      class=\"inline-flex items-center gap-1 font-medium text-n-slate-12\"\n      :style=\"{ color: widgetColor }\"\n      @click=\"startConversation\"\n    >\n      <span>\n        {{\n          hasConversation\n            ? $t('CONTINUE_CONVERSATION')\n            : $t('START_CONVERSATION')\n        }}\n      </span>\n      <i class=\"i-lucide-chevron-right size-5 mt-px\" />\n    </button>\n  </div>\n</template>\n","<script setup>\nimport { defineProps, defineEmits } from 'vue';\nconst props = defineProps({\n  link: {\n    type: String,\n    default: '',\n  },\n  title: {\n    type: String,\n    default: '',\n  },\n});\nconst emit = defineEmits(['selectArticle']);\nconst onClick = () => {\n  emit('selectArticle', props.link);\n};\n</script>\n\n<template>\n  <div\n    class=\"flex items-center justify-between rounded cursor-pointer text-n-slate-11 hover:text-n-slate-12 gap-2\"\n    role=\"button\"\n    @click=\"onClick\"\n  >\n    <button\n      class=\"underline-offset-2 leading-6 ltr:text-left rtl:text-right text-base\"\n    >\n      {{ title }}\n    </button>\n    <span class=\"i-lucide-chevron-right text-base shrink-0\" />\n  </div>\n</template>\n","<script setup>\nimport { defineProps, defineEmits, computed } from 'vue';\nimport ArticleListItem from './ArticleListItem.vue';\nimport { useMapGetter } from 'dashboard/composables/store';\n\nconst props = defineProps({\n  articles: {\n    type: Array,\n    default: () => [],\n  },\n});\n\nconst emit = defineEmits(['view', 'viewAll']);\n\nconst widgetColor = useMapGetter('appConfig/getWidgetColor');\n\nconst articlesToDisplay = computed(() => props.articles.slice(0, 6));\n\nconst onArticleClick = link => {\n  emit('view', link);\n};\n</script>\n\n<template>\n  <div class=\"flex flex-col gap-3\">\n    <h3 class=\"font-medium text-n-slate-12\">\n      {{ $t('PORTAL.POPULAR_ARTICLES') }}\n    </h3>\n    <div class=\"flex flex-col gap-4\">\n      <ArticleListItem\n        v-for=\"article in articlesToDisplay\"\n        :key=\"article.slug\"\n        :link=\"article.link\"\n        :title=\"article.title\"\n        @select-article=\"onArticleClick\"\n      />\n    </div>\n    <div>\n      <button\n        class=\"font-medium tracking-wide inline-flex\"\n        :style=\"{ color: widgetColor }\"\n        @click=\"$emit('viewAll')\"\n      >\n        <span>{{ $t('PORTAL.VIEW_ALL_ARTICLES') }}</span>\n      </button>\n    </div>\n  </div>\n</template>\n","<template>\n  <div class=\"py-4 space-y-4\">\n    <div class=\"space-y-2 animate-pulse\">\n      <div class=\"h-6 bg-n-slate-5 dark:bg-n-alpha-black1 rounded w-2/5\" />\n    </div>\n    <div class=\"space-y-2 animate-pulse\">\n      <div class=\"h-4 bg-n-slate-5 dark:bg-n-alpha-black1 rounded\" />\n      <div class=\"h-4 bg-n-slate-5 dark:bg-n-alpha-black1 rounded\" />\n      <div class=\"h-4 bg-n-slate-5 dark:bg-n-alpha-black1 rounded\" />\n    </div>\n    <div class=\"space-y-2 animate-pulse\">\n      <div class=\"h-4 bg-n-slate-5 dark:bg-n-alpha-black1 rounded w-1/5\" />\n    </div>\n  </div>\n</template>\n","/**\n * Determine the best-matching locale from the list of locales allowed by the portal.\n *\n * The matching happens in the following order:\n * 1. Exact match – the visitor-selected locale equals one in the `allowedLocales` list\n *    (e.g., `fr` ➜ `fr`).\n * 2. Base language match – the base part of a compound locale (before the underscore)\n *    matches (e.g., `fr_CA` ➜ `fr`).\n * 3. Variant match – when the base language is selected but a regional variant exists\n *    in the portal list (e.g., `fr` ➜ `fr_BE`).\n *\n * If none of these rules find a match, the function returns `null`,\n * Don't show popular articles if locale doesn't match with allowed locales\n *\n * @export\n * @param {string} selectedLocale The locale selected by the visitor (e.g., `fr_CA`).\n * @param {string[]} allowedLocales Array of locales enabled for the portal.\n * @returns {(string|null)} A locale string that should be used, or `null` if no suitable match.\n */\nexport const getMatchingLocale = (selectedLocale = '', allowedLocales = []) => {\n  // Ensure inputs are valid\n  if (\n    !selectedLocale ||\n    !Array.isArray(allowedLocales) ||\n    !allowedLocales.length\n  ) {\n    return null;\n  }\n\n  const [lang] = selectedLocale.split('_');\n\n  const priorityMatches = [\n    selectedLocale, // exact match\n    lang, // base language match\n    allowedLocales.find(l => l.startsWith(`${lang}_`)), // first variant match\n  ];\n\n  // Return the first match that exists in the allowed list, or null\n  return priorityMatches.find(l => l && allowedLocales.includes(l)) ?? null;\n};\n","<script setup>\nimport { computed, onMounted, watch } from 'vue';\nimport ArticleBlock from 'widget/components/pageComponents/Home/Article/ArticleBlock.vue';\nimport ArticleCardSkeletonLoader from 'widget/components/pageComponents/Home/Article/SkeletonLoader.vue';\nimport { useI18n } from 'vue-i18n';\nimport { useRouter } from 'vue-router';\nimport { useStore } from 'dashboard/composables/store';\nimport { useMapGetter } from 'dashboard/composables/store.js';\nimport { useDarkMode } from 'widget/composables/useDarkMode';\nimport { getMatchingLocale } from 'shared/helpers/portalHelper';\n\nconst store = useStore();\nconst router = useRouter();\nconst i18n = useI18n();\nconst { prefersDarkMode } = useDarkMode();\n\nconst portal = computed(() => window.chatwootWebChannel.portal);\n\nconst popularArticles = useMapGetter('article/popularArticles');\nconst articleUiFlags = useMapGetter('article/uiFlags');\n\nconst locale = computed(() => {\n  const { locale: selectedLocale } = i18n;\n\n  if (!portal.value || !portal.value.config) return null;\n\n  const { allowed_locales: allowedLocales } = portal.value.config;\n  return getMatchingLocale(selectedLocale.value, allowedLocales);\n});\n\nconst fetchArticles = () => {\n  if (portal.value && locale.value) {\n    store.dispatch('article/fetch', {\n      slug: portal.value.slug,\n      locale: locale.value,\n    });\n  }\n};\n\nconst openArticleInArticleViewer = link => {\n  const params = new URLSearchParams({\n    show_plain_layout: 'true',\n    theme: prefersDarkMode.value ? 'dark' : 'light',\n    ...(locale.value && { locale: locale.value }),\n  });\n\n  // Combine link with query parameters\n  const linkToOpen = `${link}?${params.toString()}`;\n  router.push({ name: 'article-viewer', query: { link: linkToOpen } });\n};\n\nconst viewAllArticles = () => {\n  const {\n    portal: { slug },\n  } = window.chatwootWebChannel;\n  openArticleInArticleViewer(`/hc/${slug}/${locale.value}`);\n};\n\nconst hasArticles = computed(\n  () =>\n    !articleUiFlags.value.isFetching &&\n    !articleUiFlags.value.isError &&\n    !!popularArticles.value.length &&\n    !!locale.value\n);\n\n// Watch for locale changes and refetch articles\nwatch(locale, (newLocale, oldLocale) => {\n  if (newLocale && newLocale !== oldLocale) {\n    fetchArticles();\n  }\n});\n\nonMounted(() => fetchArticles());\n</script>\n\n<template>\n  <div\n    v-if=\"portal && (articleUiFlags.isFetching || !!popularArticles.length)\"\n    class=\"w-full shadow outline-1 outline outline-n-container rounded-xl bg-n-background dark:bg-n-solid-2 px-5 py-4\"\n  >\n    <ArticleBlock\n      v-if=\"hasArticles\"\n      :articles=\"popularArticles\"\n      @view=\"openArticleInArticleViewer\"\n      @view-all=\"viewAllArticles\"\n    />\n    <ArticleCardSkeletonLoader v-if=\"articleUiFlags.isFetching\" />\n  </div>\n  <div v-else class=\"hidden\" />\n</template>\n","<script>\nimport TeamAvailability from 'widget/components/TeamAvailability.vue';\nimport { mapGetters } from 'vuex';\nimport { useRouter } from 'vue-router';\nimport configMixin from 'widget/mixins/configMixin';\nimport ArticleContainer from '../components/pageComponents/Home/Article/ArticleContainer.vue';\nexport default {\n  name: 'Home',\n  components: {\n    ArticleContainer,\n    TeamAvailability,\n  },\n  mixins: [configMixin],\n  setup() {\n    const router = useRouter();\n    return { router };\n  },\n  computed: {\n    ...mapGetters({\n      availableAgents: 'agent/availableAgents',\n      conversationSize: 'conversation/getConversationSize',\n      unreadMessageCount: 'conversation/getUnreadMessageCount',\n    }),\n  },\n  methods: {\n    startConversation() {\n      if (this.preChatFormEnabled && !this.conversationSize) {\n        return this.router.replace({ name: 'prechat-form' });\n      }\n      return this.router.replace({ name: 'messages' });\n    },\n  },\n};\n</script>\n\n<template>\n  <div class=\"z-50 flex flex-col justify-end flex-1 w-full p-4 gap-4\">\n    <TeamAvailability\n      :available-agents=\"availableAgents\"\n      :has-conversation=\"!!conversationSize\"\n      :unread-count=\"unreadMessageCount\"\n      @start-conversation=\"startConversation\"\n    />\n\n    <ArticleContainer />\n  </div>\n</template>\n"],"names":["props","__props","emit","__emit","widgetColor","useMapGetter","startConversation","IFrameHelper","CHATWOOT_ON_START_CONVERSATION","onClick","articlesToDisplay","computed","onArticleClick","link","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_hoisted_1","getMatchingLocale","selectedLocale","allowedLocales","lang","l","store","useStore","router","useRouter","i18n","useI18n","prefersDarkMode","useDarkMode","portal","popularArticles","articleUiFlags","locale","fetchArticles","openArticleInArticleViewer","params","linkToOpen","viewAllArticles","slug","hasArticles","watch","newLocale","oldLocale","onMounted","_sfc_main","ArticleContainer","TeamAvailability","configMixin","mapGetters","_createVNode","_component_TeamAvailability","$options","_component_ArticleContainer"],"mappings":"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"}